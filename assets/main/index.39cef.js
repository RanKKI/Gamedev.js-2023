window.__require=function e(t,n,o){function r(c,a){if(!n[c]){if(!t[c]){var s=c.split("/");if(s=s[s.length-1],!t[s]){var u="function"==typeof __require&&__require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var l=n[c]={exports:{}};t[c][0].call(l.exports,function(e){return r(t[c][1][e]||e)},l,l.exports,e,t,n,o)}return n[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<o.length;c++)r(o[c]);return r}({Main:[function(e,t,n){"use strict";cc._RF.push(t,"27ce8S4IPNMBLINswmKXlTv","Main");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./manager/ui-manager"),u=e("./user/userdata"),l=e("./game-logic/card-manager"),p=cc._decorator,f=p.ccclass,d=p.menu,h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(){return c(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return console.log("Main start"),[4,l.cardConfigManager.loadConfigs()];case 1:return e.sent(),[4,this.loadUserData()];case 2:return e.sent(),[4,s.UI.openLayer("prefab/layers/StartLayer",null)];case 3:return e.sent(),[2]}})})},t.prototype.loadUserData=function(){return c(this,void 0,void 0,function(){return a(this,function(){return console.log("load user data"),u.userData.load(),console.debug("load debug data"),u.userData.loadDebug(),console.log("finish load user data"),[2]})})},i([f,d("components/Main")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"./game-logic/card-manager":"card-manager","./manager/ui-manager":"ui-manager","./user/userdata":"userdata"}],"action-label":[function(e,t,n){"use strict";cc._RF.push(t,"95149PJXKVBbrAIoBWvQ1yd","action-label");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../common/object-pool"),a=cc._decorator,s=a.ccclass,u=a.property,l=a.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return r(t,e),t.prototype.setText=function(e){this.label.string=e},t.prototype.do=function(e,t){var n=this;this.setText(e),this.node.parent=t,this.node.opacity=0,this.node.setPosition(cc.Vec2.ZERO),cc.tween(this.node).parallel(cc.tween().to(1,{y:50},{easing:cc.easing.sineIn}),cc.tween().to(.5,{opacity:255}).to(.5,{opacity:0})).call(function(){n.reset()}).start()},t.prototype.reset=function(){this.node.parent=null,this.node.angle=0,c.objectPool.actionLabelsPool.put(this.node)},i([u(cc.Label)],t.prototype,"label",void 0),i([s,l("components/ActionLabel")],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../common/object-pool":"object-pool"}],bar:[function(e,t,n){"use strict";cc._RF.push(t,"6d7d4JfuIFIkLULRZWhl/NR","bar");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.BarComponent=void 0;var c=cc._decorator,a=c.ccclass,s=c.property,u=c.menu,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mask=null,t._value=0,t}return r(t,e),t.prototype.start=function(){this.setPercentage(1,!1)},t.prototype.setPercentage=function(e,t){this._value=e;var n=5+(this.node.width-10)*e;t?(cc.Tween.stopAllByTarget(this.mask),cc.tween(this.mask).to(.2,{width:n}).start()):this.mask.width=n},i([s(cc.Node)],t.prototype,"mask",void 0),i([a,u("components/Bar")],t)}(cc.Component);n.BarComponent=l,cc._RF.pop()},{}],"base-layer":[function(e,t,n){"use strict";cc._RF.push(t,"6e5ecjPvvxFMY09MKOcAVES","base-layer");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../common"),u=cc._decorator.ccclass,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="",t}return r(t,e),t.prototype.init=function(e){this.options=e},t.prototype.preLoad=function(){return c(this,void 0,void 0,function(){return a(this,function(){return[2]})})},t.prototype.show=function(){this.onShow()},t.prototype.onShow=function(){},t.prototype.hide=function(){this.onHide()},t.prototype.onHide=function(){},t.prototype.close=function(){var e=this.node;e.emit(s.Event.BEFORE_NODE_REMOVE,e),e.active=!1,e.removeFromParent(),e.emit(s.Event.ON_NODE_REMOVE,e),e.parent=null},i([u],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../../common":"index"}],"base-panel":[function(e,t,n){"use strict";cc._RF.push(t,"ad874a95yhBy6VubdYIWjDH","base-panel");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../common/common"),a=cc._decorator,s=a.ccclass,u=a.property,l=a.disallowMultiple,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.content=null,t.animDuration=.5,t.finishCallback=null,t.returnValue=null,t}return r(t,e),t.prototype.show=function(e,t){void 0===t&&(t=this.animDuration),this.options=e,this.playEnterAnima(t),this.init(this.options),this.updateDisplay(this.options)},t.prototype.playEnterAnima=function(e){var t=this,n=this.content;this.node.active=!0,n.active=!0,n.scale=.5,n.opacity=0,cc.tween(n).to(e,{scale:1,opacity:255},{easing:"backOut"}).call(function(){t.onShow&&t.onShow()}).start()},t.prototype.hide=function(e){var t=this;c.tempDisableButton(e,1),c.disableTouch(this.node,!0);var n=this.node,o=cc.tween(this.content).to(.125,{scale:1.1},{easing:cc.easing.quadOut}).parallel(cc.tween(this.content).to(.25,{scale:.5},{easing:cc.easing.quadIn}),cc.tween(this.content).delay(1/24).to(.25,{opacity:0})).call(function(){n.active=!1,t.onHide&&t.onHide(),c.disableTouch(t.node,!1),t.finishCallback&&t.finishCallback(n,t.returnValue)});return new Promise(function(e){o.call(function(){e()}).start()})},t.prototype.init=function(){},t.prototype.updateDisplay=function(){},t.prototype.onShow=function(){},t.prototype.onHide=function(){},t.prototype.setFinishCallback=function(e){this.finishCallback=e},t.prototype.setReturnValue=function(e){this.returnValue=e},i([u(cc.Node)],t.prototype,"content",void 0),i([s,l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../common/common":"common"}],"card-data-type":[function(e,t){"use strict";cc._RF.push(t,"7d89fKaOzlJFZ4px5FMbFdm","card-data-type"),cc._RF.pop()},{}],"card-deck":[function(e,t,n){"use strict";cc._RF.push(t,"66db1/pPZtAXp/6n44p2OY3","card-deck");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},u=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],c=0,a=i.length;c<a;c++,r++)o[r]=i[c];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.CardDeckComponent=n.CardDeckMode=void 0;var l,p=e("../common"),f=e("../common/object-pool"),d=e("../common/sound"),h=e("../game-logic/card-manager"),y=e("../manager/ui-manager"),v=e("./action-label"),b=e("./bar"),g=e("./card"),m=e("./ext/linked-prefab"),_=cc._decorator,w=_.ccclass,P=_.property,C=_.menu;(function(e){e[e.Player=0]="Player",e[e.Computer=1]="Computer"})(l=n.CardDeckMode||(n.CardDeckMode={}));var O={None:0,UsedStrength:2,HPChanged:4},k={block:0,strength:0,hp:30},T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.deck=null,t.cards=[],t.mode=null,t.round=0,t.hpBarPrefab=null,t.playerAttributes=i({},k),t.effects=[],t.cardsPool=[],t.nextCardIdx=0,t.cardPoolNode=null,t.triggers=O.None,t.actionLabelRoot=null,t}return r(t,e),t.prototype.setMode=function(e){this.mode!==e&&(this.mode=e)},Object.defineProperty(t.prototype,"selfName",{get:function(){return this.mode===l.Player?"Player":"Computer"},enumerable:!1,configurable:!0}),t.prototype.setRound=function(e){this.round=e},t.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,u(["["+this.round+"]["+this.selfName+"]"],e))},t.prototype.start=function(){},t.prototype.createCard=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<5?[4,this.drawCard()]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.reorderCard=function(e){return void 0===e&&(e=!0),a(this,void 0,void 0,function(){var t,n,o,r,i;return s(this,function(c){switch(c.label){case 0:for(t=[],n=function(n,r){var i=o.cards[n],c=o.getCardX(n);i.node.setSiblingIndex(r-n-1),e?t.push(new Promise(function(e){cc.tween(i.node).to(.2,{x:c}).call(function(){e()}).start()})):i.node.x=c},o=this,r=0,i=this.cards.length;r<i;r++)n(r,i);return[4,Promise.all(t)];case 1:return c.sent(),[2]}})})},t.prototype.getCardX=function(e){return 50+20*e},Object.defineProperty(t.prototype,"hpBar",{get:function(){return this.hpBarPrefab.getComponent(b.BarComponent)},enumerable:!1,configurable:!0}),t.prototype.getAttributes=function(){return this.playerAttributes},t.prototype.resetAttributes=function(){this.playerAttributes=i({},k),this.triggers=O.None},t.prototype.isDead=function(){return this.playerAttributes.hp<=0},t.prototype.addHP=function(e){if(0!=e){this.playerAttributes.hp+=e;var t=this.playerAttributes.hp;this.hpBar.setPercentage(t/30,!0),this.log("HP "+(e>0?"+":"-")+Math.abs(e)+", HP: "+t)}},t.prototype.setHP=function(e){this.playerAttributes.hp=e,this.hpBar.setPercentage(e/30)},t.prototype.resetCardsPool=function(){this.cardsPool=[],this.nextCardIdx=0},t.prototype.getNextCardConf=function(){if(this.cardsPool.length<=0)throw new Error("\u5361\u6c60\u4e3a\u7a7a");var e=this.cardsPool[this.nextCardIdx%this.cardsPool.length];return this.nextCardIdx++,e},t.prototype.prepare=function(e){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.resetCardsPool(),this.cardsPool=u(e),this.resetAttributes(),this.effects=[],[4,this.createCard()];case 1:return t.sent(),this.log(this.cards.map(function(e){return e.conf.name})),[2]}})})},t.prototype.drawCard=function(){return a(this,void 0,void 0,function(){var e,t,n;return s(this,function(o){switch(o.label){case 0:return[4,f.objectPool.cardPool.get()];case 1:return(e=o.sent()).setPosition(this.cardPoolNode.node.getPosition()),(t=e.getComponent(g.CardComponent)).setIsVisible(this.mode===l.Player),this.deck.addChild(e),this.cards.push(t),n=this.getNextCardConf(),t.setCardConf(n),[4,this.reorderCard(!0)];case 2:return o.sent(),[2]}})})},t.prototype.useCard=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=[this.reorderCard(),new Promise(function(t){cc.tween(e.node).to(.2,{opacity:0}).call(function(){e.node.parent=null,f.objectPool.cardPool.put(e.node),t()}).start()})],[4,Promise.all(t)];case 1:return n.sent(),[2]}})})},t.prototype.play=function(e){return a(this,void 0,Promise,function(){var t,n,o;return s(this,function(r){switch(r.label){case 0:return this.needsSkip()?(this.log("Skip this turn"),[2,[]]):(this.beforeUseCard(),t=this.cards.splice(0,1)[0],this.log("Play card",t.conf.name),n=cc.v2(0,0),y.UI.getTopLayer().node.convertToWorldSpaceAR(n,n),t.node.parent.convertToNodeSpaceAR(n,n),t.beforeMoving(),t.setMoving(),[4,Promise.all([new Promise(function(e){cc.tween(t.node).to(.8,{x:n.x,y:n.y},{easing:cc.easing.sineIn}).call(function(){e()}).start()}),p.sleep(.4).then(function(){return t.setIsVisible(!0,!0)})])]);case 1:return r.sent(),[4,Promise.all([this.useCard(t),this.drawCard()])];case 2:return r.sent(),o=h.cardConfigManager.convertToCommands(t.conf),o=this.applySelfCommands(o,e),o=this.applyEffectBeforeUseCard(o,e),this.afterUseCard(),[2,o]}})})},t.prototype.addTrigger=function(e){this.triggers|=e},t.prototype.removeTrigger=function(e){this.triggers&=~e},t.prototype.isTrigger=function(e){return 0!=(this.triggers&e)},t.prototype.beforeUseCard=function(){this.playerAttributes.strength>0&&(this.playerAttributes.strength=Math.max(0,this.playerAttributes.strength-1),this.log("reduce strength by 1, now = ",this.playerAttributes.strength))},t.prototype.afterUseCard=function(){this.isTrigger(O.UsedStrength)&&(this.removeTrigger(O.UsedStrength),this.log("Used strength, reset strength to 0"),this.playerAttributes.strength=0)},t.prototype.applyEffectBeforeUseCard=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t],r=this.playerAttributes.strength,i=o.value;"attack"===o.type&&r>0&&(o.value+=r,this.addTrigger(O.UsedStrength),this.log("Apply strength",r,", increased attack from "+i+" to "+o.value))}return e},t.prototype.applySelfCommands=function(e,t){var n=["block","block_strength","strength","vengeance"],o=this.findCommandsByType(e,n),r=this.callCommands(o,t);return u(e.filter(function(e){return!n.includes(e.type)}),r)},t.prototype.needsSkip=function(){var e=this.effects.find(function(e){return"skipturn"===e.type});return!!e&&(e.value--,e.value<=0&&this.effects.splice(this.effects.indexOf(e),1),!0)},t.prototype.execute=function(e,t){return a(this,void 0,void 0,function(){var n,o;return s(this,function(){return n=i({},this.playerAttributes),o=this.findCommandsByType(e,"effect"),e=(e=this.applyEffects(o,e)).filter(function(e){return"effect"!==e.type}),this.callCommands(e,t),this.playerAttributes.hp!=n.hp?this.addTrigger(O.HPChanged):this.removeTrigger(O.HPChanged),[2]})})},t.prototype.callCommands=function(e,t){for(var n=[],o=0,r=e.length;o<r;o++){var i=e[o],c=this["execute_"+i.type];if(c){var a=c.call(this,i,t);a&&n.push(a)}else this.log("not found execute for command",i.type)}return n},t.prototype.execute_attack=function(e){d.sound.play(d.Sound.ATTACK);var t=e.value,n=this.playerAttributes.block;n>0&&(n>=t?(n-=t,t=0):(t-=n,n=0)),this.playerAttributes.block=n,t!=e.value?this.log("attacked by",t,"damage","(origin damage = "+e.value+")"):this.log("attacked by",t,"damage"),this.addAction("-"+t+" HP"),this.addHP(-t)},t.prototype.execute_skipturn=function(e){this.effects.push(e)},t.prototype.execute_block=function(e){d.sound.play(d.Sound.BLOCK);var t=Math.max(0,e.value);this.log("add block",t),this.addAction("+"+t+" Block"),this.playerAttributes.block+=t},t.prototype.execute_block_strength=function(e,t){d.sound.play(d.Sound.BLOCK);var n=Math.max(0,e.value+t.strength);this.log("add block",n),this.addAction("+"+n+" Block"),this.playerAttributes.block+=n},t.prototype.execute_strength=function(e){d.sound.play(d.Sound.STRENGTH),this.log("add strength",e.value),this.addAction("+"+e.value+" Strength"),this.playerAttributes.strength+=e.value},t.prototype.execute_vengeance=function(){d.sound.play(d.Sound.VENGEANCE);var e=this.isTrigger(O.HPChanged)?6:3;return this.log("Vengeance triggered, deal "+e+"  damage to enemy"),{type:"attack",value:e}},t.prototype.findCommandsByType=function(e,t){var n=Array.isArray(t)?t:[t];return e.filter(function(e){return n.findIndex(function(t){return t==e.type})>=0})},t.prototype.applyBuff=function(e,t){var n=e.value;"percent"===e.valueType&&(n=t.value*e.value);var o=e.value+("percent"==e.valueType?"%":"");this.log("use effect on",e.on,"value",n,"raw",o),t.value+=n},t.prototype.applyEffects=function(e,t){for(var n=function(n){for(var r=t[n],i=e.filter(function(e){return e.buff.on===r.type}),c=0,a=i.length;c<a;c++){var s=i[c];if(!(p.random(0,1)>s.value)){var u=s.buff;o.applyBuff(u,r)}}},o=this,r=0,i=t.length;r<i;r++)n(r);return t},t.prototype.addAction=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,f.objectPool.actionLabelsPool.get()];case 1:return(t=n.sent()).getComponent(v.default).do(e,this.actionLabelRoot),this.mode==l.Computer&&(t.angle=-180),[2]}})})},c([P(cc.Node)],t.prototype,"deck",void 0),c([P(m.default)],t.prototype,"hpBarPrefab",void 0),c([P(m.default)],t.prototype,"cardPoolNode",void 0),c([P(cc.Node)],t.prototype,"actionLabelRoot",void 0),c([w,C("components/CardDeck")],t)}(cc.Component);n.CardDeckComponent=T,cc._RF.pop()},{"../common":"index","../common/object-pool":"object-pool","../common/sound":"sound","../game-logic/card-manager":"card-manager","../manager/ui-manager":"ui-manager","./action-label":"action-label","./bar":"bar","./card":"card","./ext/linked-prefab":"linked-prefab"}],"card-manager":[function(e,t,n){"use strict";cc._RF.push(t,"554f8t/sZ5JTr/VIAzTNVaA","card-manager");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.cardConfigManager=void 0;var i=e("../manager/resources"),c=e("./command-parser"),a=function(){function e(){}return e.prototype.loadJSONConfig=function(e){return o(this,void 0,void 0,function(){return r(this,function(){return[2,i.loadLocalRes("configs/"+e)]})})},e.prototype.getCard=function(e){var t=this.cardConfig[e];if(!t)throw new Error("card not found: "+e);return t},e.prototype.loadCardConfig=function(){return o(this,void 0,void 0,function(){var e,t,n,o,i,c;return r(this,function(r){switch(r.label){case 0:return console.log("load card config"),[4,this.loadJSONConfig("card")];case 1:if(!(e=r.sent())||!e.json)throw new Error("load card config failed");for(t=e.json,this.cardConfig={},n=0,o=t;n<o.length;n++)i=o[n],c={id:i.id,name:i.name,description:i.description,resource:i.resource,effects:Array.isArray(i.effects)?i.effects:[i.effects]},this.cardConfig[c.id]=c;return console.log("load card config done"),[2]}})})},e.prototype.validateCards=function(){return o(this,void 0,void 0,function(){var e,t;return r(this,function(){if(e=Object.keys(this.cardConfig),t=new Set(e),e.length!==t.size)throw new Error("duplicate card id");return[2]})})},e.prototype.loadConfigs=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return console.log("load configs"),[4,Promise.all([this.loadCardConfig()])];case 1:return e.sent(),this.validateCards(),console.log("load configs done"),[2]}})})},e.prototype.convertToCommands=function(e){if(null==e.effects)throw new Error("no effect for card "+e.id);for(var t=[],n=0,o=e.effects;n<o.length;n++){var r=o[n];t.push(c.cmdParser.parse(r))}return t},e}();n.cardConfigManager=new a,cc._RF.pop()},{"../manager/resources":"resources","./command-parser":"command-parser"}],"card-placeholder":[function(e,t,n){"use strict";cc._RF.push(t,"af677a+djJBToI+2FHaDYPf","card-placeholder");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.CardPlaceholderComponent=void 0;var c=e("../common"),a=cc._decorator,s=a.ccclass,u=a.property,l=a.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.collider=null,t.lockNode=null,t.isLocked=!1,t.holderIdx=0,t}return r(t,e),t.prototype.setIsLocked=function(e){this.isLocked=e,this.lockNode.active=e},t.prototype.hitTest=function(e){var t=cc.Vec2.ZERO;return t=e instanceof cc.Event.EventTouch?c.getLocalTouchPos(e,this.node):e,cc.Intersection.pointInPolygon(t,this.collider.points)},i([u(cc.PolygonCollider)],t.prototype,"collider",void 0),i([u(cc.Node)],t.prototype,"lockNode",void 0),i([s,l("components/CardPlaceholder")],t)}(cc.Component);n.CardPlaceholderComponent=p,cc._RF.pop()},{"../common":"index"}],card:[function(e,t,n){"use strict";cc._RF.push(t,"3362fug6qFPhrfwILAXG8W0","card");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CardComponent=void 0;var s=e("../common"),u=e("../manager/resources"),l=cc._decorator,p=l.ccclass,f=l.property,d=l.menu,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cardNode=null,t.cardBg=null,t.selected=null,t.collider=null,t.cardSprite=null,t.descriptionNode=null,t.descriptionLabel=null,t.isVisible=!1,t.bSelected=!1,t.currentAngle=0,t.currentPos=null,t.currentZIndex=0,t.conf=null,t}return r(t,e),t.prototype.start=function(){this.setIsVisible(this.isVisible),this.setSelect(this.bSelected),this.hideDescription()},t.prototype.setIsVisible=function(e,t){return c(this,void 0,void 0,function(){var n,o,r=this;return a(this,function(i){switch(i.label){case 0:return e==this.isVisible?[2]:(this.isVisible=e,this.cardNode.active=e,this.cardBg.active=!e,t&&null!=t?(this.cardNode.opacity=e?0:255,this.cardBg.opacity=e?255:0,n=new Promise(function(t){cc.tween(r.cardNode).to(.4,{opacity:e?255:0},{easing:cc.easing.sineIn}).call(function(){t(),r.cardNode.active=e}).start()}),o=new Promise(function(t){cc.tween(r.cardBg).to(.2,{opacity:e?0:255}).call(function(){r.cardBg.active=!e,t()}).start()}),[4,Promise.all([n,o])]):[2]);case 1:return i.sent(),[2]}})})},t.prototype.hitTest=function(e){var t=cc.Vec2.ZERO;return t=e instanceof cc.Event.EventTouch?s.getLocalTouchPos(e,this.node):e,cc.Intersection.pointInPolygon(t,this.collider.points)},t.prototype.getDataBeforeMoving=function(){return{pos:this.currentPos,zIndex:this.currentZIndex}},t.prototype.beforeMoving=function(){null!=this.node&&(this.currentAngle=this.node.angle,this.currentPos=this.node.position.clone(),this.currentZIndex=this.node.getSiblingIndex())},t.prototype.setSelect=function(e){this.selected.active=e,this.bSelected=e},t.prototype.setMoving=function(e){void 0===e&&(e=null),this.node.angle=0,this.node.setSiblingIndex(this.node.parent.childrenCount-1),e&&this.updateMoving(e)},t.prototype.updateMoving=function(e){var t=e.getLocation();cc.Camera.main.getScreenToWorldPoint(t,t),this.node.parent.convertToNodeSpaceAR(t,t),this.node.setPosition(t)},t.prototype.afterMoving=function(e){e&&(this.node.angle=this.currentAngle,this.node.position=this.currentPos,this.node.setSiblingIndex(this.currentZIndex))},t.prototype.setCardConf=function(e){var t=this;this.conf=e,u.loadRes("ui/card/"+e.resource,cc.SpriteFrame).then(function(e){t.cardSprite.spriteFrame=e}),this.descriptionLabel.string=e.description},t.prototype.recycle=function(){this.hideDescription(),this.setIsVisible(!1),this.setSelect(!1),this.node.angle=0,this.node.position=cc.Vec3.ZERO,this.node.setSiblingIndex(0),this.currentAngle=0,this.currentPos=null,this.currentZIndex=0,this.node.opacity=255,this.cardNode.opacity=255,this.cardBg.opacity=255,this.conf=null},t.prototype.showDescription=function(){this.descriptionNode.active=!0},t.prototype.hideDescription=function(){this.descriptionNode.active=!1},i([f(cc.Node)],t.prototype,"cardNode",void 0),i([f(cc.Node)],t.prototype,"cardBg",void 0),i([f(cc.Node)],t.prototype,"selected",void 0),i([f(cc.PolygonCollider)],t.prototype,"collider",void 0),i([f(cc.Sprite)],t.prototype,"cardSprite",void 0),i([f(cc.Node)],t.prototype,"descriptionNode",void 0),i([f(cc.Label)],t.prototype,"descriptionLabel",void 0),i([p,d("components/Card")],t)}(cc.Component);n.CardComponent=h,cc._RF.pop()},{"../common":"index","../manager/resources":"resources"}],"command-parser":[function(e,t,n){"use strict";cc._RF.push(t,"43abbNixjhM2LC9mGLXI6ar","command-parser"),Object.defineProperty(n,"__esModule",{value:!0}),n.cmdParser=void 0;var o=function(){function e(){var e=this;this.parsers={};for(var t=0,n=["attack","energy","skipturn","block","strength","block_strength","vengeance"];t<n.length;t++){var o=n[t];this.parsers[o]=function(t){return e.parseNormalCommand(t)}}this.parsers.effect=function(t){return e.parseEffect(t)}}return e.prototype.parsePercent=function(e){return e.endsWith("%")?parseInt(e.slice(0,e.length-1))/100:parseInt(e)},e.prototype.getValueType=function(e){return e.endsWith("%")?"percent":"number"},e.prototype.parseNormalCommand=function(e){return 1==e.length?{type:e[0],value:0}:{type:e[0],value:parseInt(e[1])}},e.prototype.parseEffect=function(e){return{type:"effect",value:this.parsePercent(e[1]),buff:{type:"buff",on:e[3],value:this.parsePercent(e[2]),valueType:this.getValueType(e[2])}}},e.prototype.parse=function(e){var t=e.split(" "),n=t[0],o=this.parsers[n];if(!o)throw new Error("unknown command type: "+n);return o(t)},e}();n.cmdParser=new o,cc._RF.pop()},{}],common:[function(e,t,n){"use strict";cc._RF.push(t,"bdd80aPButDZpSjcYdhHeUq","common");var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],c=0,a=i.length;c<a;c++,r++)o[r]=i[c];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.getLocalTouchPos=n.isPord=n.mapRange=n.clamp=n.deepClone=n.mergeDeep=n.isObject=n.randomChoice=n.randomChoiceOne=n.shuffleArr=n.sleep=n.compareVersion=n.random=n.randomInt=n.disableTouch=n.tempDisableButton=n.disableBtn=n.resetGlobalBlockInputComp=n.disableAllTouch=n.showNode=n.toThousands=n.curCanvas=n.getScreenHeight=n.getScreenWidth=void 0,n.getScreenWidth=function(){return cc.view.getCanvasSize().width},n.getScreenHeight=function(){return cc.view.getCanvasSize().height},n.curCanvas=function(){var e=cc.director.getScene();return cc.find("Canvas",e)},n.toThousands=function(e){return void 0===e&&(e=0),e.toString().replace(/\d+/,function(e){return e.replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")})},n.showNode=function(e,t,n,o){void 0===o&&(o=0),n&&(e.scale=0,cc.tween(e).delay(o).to(n,{scale:1}).start()),null!=e&&(e.active=t)};var r=null;function i(e,t){e.interactable=!t}function c(e){for(var t=e.length-1;t>=0;t--){var n=Math.floor(Math.random()*(t+1)),o=e[n];e[n]=e[t],e[t]=o}return e}function a(e,t){return c(Object.assign([],e)).slice(0,t)}function s(e){return e&&"object"==typeof e&&!Array.isArray(e)}function u(e,t,n){return e<t?t:e>n?n:e}n.disableAllTouch=function(e){if(null==r){var t=cc.director.getScene().getComponentInChildren(cc.Canvas).node.children,n=t[t.length-1];r=n.getComponent(cc.BlockInputEvents)}r?r.enabled=e:console.error("globalBlockInputComp is null")},n.resetGlobalBlockInputComp=function(){r=null},n.disableBtn=i,n.tempDisableButton=function(e,t){if(void 0===t&&(t=0),null!=e){e instanceof cc.Event.EventTouch&&(e=e.target);var n=null;if(e instanceof cc.Button?n=e:e instanceof cc.Node&&(n=e.getComponent(cc.Button)),null!=n){var o=function(){i(n,!1)};return i(n,!0),n.scheduleOnce(o,t),function(){o(),n.unschedule(o)}}}},n.disableTouch=function(e,t){t?e.pauseSystemEvents(!0):e.resumeSystemEvents(!0)},n.randomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e},n.random=function(e,t){return Math.random()*(t-e)+e},n.compareVersion=function(e,t){for(var n=e.split("."),o=t.split("."),r=Math.max(n.length,o.length);n.length<r;)n.push("0");for(;o.length<r;)o.push("0");for(var i=0;i<r;i++){var c=parseInt(n[i]),a=parseInt(o[i]);if(c>a)return 1;if(c<a)return-1}return 0},n.sleep=function(e,t){return new Promise(function(n){t?t.scheduleOnce(function(){n()},e):cc.director.getScene().getComponentInChildren(cc.Canvas).scheduleOnce(function(){n()},e)})},n.shuffleArr=c,n.randomChoiceOne=function(e){return a(e,1)[0]},n.randomChoice=a,n.isObject=s,n.mergeDeep=function e(t){for(var n,r,i=[],c=1;c<arguments.length;c++)i[c-1]=arguments[c];if(!i.length)return t;var a=i.shift();if(s(t)&&s(a))for(var u in a)s(a[u])?(t[u]||Object.assign(t,((n={})[u]={},n)),e(t[u],a[u])):Object.assign(t,((r={})[u]=a[u],r));return e.apply(void 0,o([t],i))},n.deepClone=function e(t){var n;if("object"==typeof t)if(Array.isArray(t))for(var o in n=[],t)n.push(e(t[o]));else if(null===t)n=null;else if(t.constructor===RegExp)n=t;else for(var o in n={},t)n[o]=e(t[o]);else n=t;return n},n.clamp=u,n.mapRange=function(e,t,n,o,r){return u((e-t)*(r-o)/(n-t)+o,o,r)},n.isPord=!1,n.getLocalTouchPos=function(e,t){var n=e.getLocation();return cc.Camera.main.getScreenToWorldPoint(n,n),t.convertToNodeSpaceAR(n,n),n},cc._RF.pop()},{}],env:[function(e,t,n){"use strict";var o;cc._RF.push(t,"0ff909GluFHlajfQQM3N0t0","env"),Object.defineProperty(n,"__esModule",{value:!0}),n.env=n.EnvMode=void 0,function(e){e.Debug="Debug",e.TEST="Test",e.PROD="Prod"}(o=n.EnvMode||(n.EnvMode={})),n.env={version:"0.1.1",mode:o.TEST,network:{server:"https://xbtnc-test.hortor003.com",retryT:2,defaultRetryCnt:3,resourceURL:""}},cc._RF.pop()},{}],events:[function(e,t,n){"use strict";cc._RF.push(t,"a793cljNWpNmr4dFxYsHJjr","events"),Object.defineProperty(n,"__esModule",{value:!0}),n.resetAllEvents=n.gameEvent=n.GameEvent=n.logEvent=n.LogLevel=n.ON_NODE_REMOVE=n.BEFORE_NODE_REMOVE=void 0;var o=e("./typed-event");n.BEFORE_NODE_REMOVE="BEFORE_NODE_REMOVE",n.ON_NODE_REMOVE="ON_NODE_REMOVE",n.LogLevel={DEBUG:0,INFO:1,WARN:2,ERROR:3},n.logEvent=new o.TypedEvent,n.GameEvent={UserRoundFinished:"UserRoundFinished"},n.gameEvent=new o.TypedEvent;var r=[n.logEvent];n.logEvent.on(function(e){e.level||n.LogLevel.DEBUG;var t=e.log||"";console.log(t)}),n.resetAllEvents=function(){r.forEach(function(e){e.reset()})},cc._RF.pop()},{"./typed-event":"typed-event"}],"finish-layer":[function(e,t,n){"use strict";cc._RF.push(t,"5440etUYAlA1p4eNV+BoGUB","finish-layer");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./components/base/base-layer"),u=e("./manager/ui-manager"),l=cc._decorator,p=l.ccclass,f=l.menu,d=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.titleLabel=null,t}return r(t,e),t.prototype.start=function(){this.titleLabel.string=this.options.label},t.prototype.enterGame=function(){return c(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,u.UI.openLayer("prefab/layers/GameLayer",null)];case 1:return e.sent(),this.close(),[2]}})})},i([d(cc.Label)],t.prototype,"titleLabel",void 0),i([p,f("components/FinishLayer")],t)}(s.default);n.default=h,cc._RF.pop()},{"./components/base/base-layer":"base-layer","./manager/ui-manager":"ui-manager"}],"game-layer":[function(e,t,n){"use strict";cc._RF.push(t,"3e88dNKx4VLHJby+XBYQ76X","game-layer");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./manager/ui-manager"),u=e("./components/base/base-layer"),l=e("./components/ext/linked-prefab"),p=e("./components/card-deck"),f=e("./common/event/events"),d=e("./common/locker"),h=cc._decorator,y=h.ccclass,v=h.menu,b=h.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.playerDeckPrefab=null,t.oppositeDeckPrefab=null,t}return r(t,e),Object.defineProperty(t.prototype,"playerDeck",{get:function(){return this.playerDeckPrefab.getComponent(p.CardDeckComponent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oppositeDeck",{get:function(){return this.oppositeDeckPrefab.getComponent(p.CardDeckComponent)},enumerable:!1,configurable:!0}),t.prototype.testPanel=function(){return c(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,s.UI.openPanel("prefab/common/confirm-panel",null)];case 1:return e.sent(),[2]}})})},t.prototype.start=function(){var e=this;this.playerDeck.setMode(p.CardDeckMode.Player),this.oppositeDeck.setMode(p.CardDeckMode.Computer),f.gameEvent.on(function(t){return e.onGameEvent(t.name,t.data)}),this.startGame()},t.prototype.onGameEvent=function(){},t.prototype.selectCards=function(){return c(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,s.UI.openPanel("prefab/select-card-panel",null)];case 1:return[2,e.sent().values]}})})},t.prototype.startGame=function(){return c(this,void 0,void 0,function(){var e,t,n,o,r,i,c,u;return a(this,function(a){switch(a.label){case 0:return e=this.playerDeck,t=this.oppositeDeck,[4,this.selectCards()];case 1:return n=a.sent(),[4,Promise.all([e.prepare(n),t.prepare(n.reverse())])];case 2:a.sent(),o=!1,r=0,a.label=3;case 3:return e.isDead()||t.isDead()?[3,8]:(e.setRound(r),t.setRound(r),[4,e.play(t.getAttributes())]);case 4:return i=a.sent(),[4,t.execute(i,t.getAttributes())];case 5:return a.sent(),t.isDead()?(o=!0,[3,8]):[4,t.play(e.getAttributes())];case 6:return c=a.sent(),[4,e.execute(c,e.getAttributes())];case 7:return a.sent(),e.isDead()?[3,8]:(r++,console.log("-----------"+r+"------------"),[3,3]);case 8:return u=o?"You Win":"You Lose",o?console.log("player win"):console.log("player lose"),[4,s.UI.openLayer("prefab/layers/FinishLayer",{label:u})];case 9:return a.sent(),this.close(),[2]}})})},i([b(l.default)],t.prototype,"playerDeckPrefab",void 0),i([b(l.default)],t.prototype,"oppositeDeckPrefab",void 0),i([d.touchLocker],t.prototype,"startGame",null),i([y,v("components/layers/GameLayer")],t)}(u.default);n.default=g,cc._RF.pop()},{"./common/event/events":"events","./common/locker":"locker","./components/base/base-layer":"base-layer","./components/card-deck":"card-deck","./components/ext/linked-prefab":"linked-prefab","./manager/ui-manager":"ui-manager"}],global:[function(e,t,n){"use strict";cc._RF.push(t,"0370f0TOChP/I/ktryt/EOw","global"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./common/locker"),r=e("./common/sound");console.log("Global script initd"),cc.Button.prototype.touchEndClone=cc.Button.prototype._onTouchEnded,cc.Button.prototype.clickSoundEffect=!0,cc.Button.prototype._onTouchEnded=function(e){this.interactable&&this.enabledInHierarchy&&this._pressed&&this.clickSoundEffect&&r.sound.play(r.Sound.COMMON),this.touchEndClone(e)},cc.internal.inputManager.oldTouchHandler=cc.internal.inputManager.handleTouchesBegin,cc.internal.inputManager.handleTouchesBegin=function(e){o.isTouchLocked()||cc.internal.inputManager.oldTouchHandler.call(this,e)},cc.macro.ENABLE_MULTI_TOUCH=!1,r.sound.playBGM(),cc._RF.pop()},{"./common/locker":"locker","./common/sound":"sound"}],http:[function(e,t,n){"use strict";cc._RF.push(t,"0eb6eWvPY5Eea4TnDOpnL2l","http");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.post=n.get=void 0;var i=e("../common"),c=e("../env"),a=e("../toast"),s={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3},u=0,l=function(){return u++};function p(e){return null==e?"":Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t]+"")}).join("&")}function f(e,t){var n=p(t);return n.length>0?e+(-1===e.indexOf("?")?"?":"&")+n:e}function d(e){var t,n={ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText,data:e.responseText};if(n.ok)try{var o=JSON.parse(e.responseText);null!=o.errcode&&o.errcode>0&&(n.ok=!1,n.status=o.errcode,n.statusText=null!==(t=o.errmsg)&&void 0!==t?t:n.statusText),n.data=o.data}catch(r){console.error("failed to parse response text",e.responseText,r)}return n}function h(e,t,n){var o=s.ignoreCache,r=s.headers,i=s.timeout;return new Promise(function(a,s){var u=new XMLHttpRequest,l=f(t,{platform:"default",ver:c.env.version});n&&(l=f(l,n.parameters)),u.open(e,l),r&&Object.keys(r).forEach(function(e){u.setRequestHeader(e,r[e])}),o&&u.setRequestHeader("Cache-Control","no-cache"),u.timeout=i,u.onload=function(){a(d(u))},u.onerror=function(){a(d(u))},u.ontimeout=function(){s(new Error("Time out"))},"post"===e&&n.body?(u.setRequestHeader("Content-Type","application/json"),u.send(JSON.stringify(n.body))):u.send()})}function y(){return o(this,void 0,Promise,function(){return r(this,function(){return[2,!1]})})}function v(e,t,n){var a,s;return o(this,void 0,Promise,function(){var o,u,p,f,d,v,b,g,m;return r(this,function(r){switch(r.label){case 0:(n=null!=n?n:{}).parameters=null!==(a=n.parameters)&&void 0!==a?a:{},n.parameters.consistKey=l(),u=function(){n.silence||(o=setTimeout(function(){},200))},p=function(){null!=o&&clearTimeout(o)},f=null==n.askToRetry||1==n.askToRetry,d=Math.max(1,null!==(s=n.maxAutoRetryCnt)&&void 0!==s?s:c.env.network.defaultRetryCnt),v=0,r.label=1;case 1:if(!(v<d||f))return[3,11];r.label=2;case 2:return r.trys.push([2,4,,10]),u(),[4,h(e,t,n)];case 3:if(b=r.sent(),p(),b.status>=200&&b.status<=399||b.status>=2e4)return[2,b];throw b;case 4:if(g=r.sent(),p(),!n.silence)return[3,6];if(v==d-1)throw g;return[4,i.sleep(.5)];case 5:return r.sent(),[3,9];case 6:return(m=!f)?[3,8]:[4,y()];case 7:m=!r.sent(),r.label=8;case 8:if(m)throw g;r.label=9;case 9:return[3,10];case 10:return v++,[3,1];case 11:return[2]}})})}var b=function(){function e(e){this.method=e,this.queue=[]}return e.prototype.isEmpty=function(){return 0==this.queue.length},e.prototype.push=function(e){e.request=e.request||{};var t=this.isEmpty();this.queue.push(e),t&&this.consume()},e.prototype.clear=function(){for(;!this.isEmpty();)this.queue.pop().onFailed(new Error("the queue of "+this.method+" was cleared"))},e.prototype.handleError=function(e,t){console.log("handle error",t),t instanceof Error?e.onFailed(t):e.onFailed(new Error(t.statusText)),e.request.silence||(t instanceof Error?a.showToast(t.message):t.statusText?a.showToast(t.statusText):a.showToast("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))},e.prototype.consume=function(){return o(this,void 0,void 0,function(){var e,t,n;return r(this,function(o){switch(o.label){case 0:e=this.queue[0],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,v(this.method,c.env.network.server+e.url,e.request)];case 2:return(t=o.sent()).ok?e.onSuccess(t):this.handleError(e,t),[3,4];case 3:return n=o.sent(),this.handleError(e,n),[3,4];case 4:return this.queue.shift(),this.isEmpty()||this.consume(),[2]}})})},e}(),g=new b("get"),m=new b("post");n.get=function(e,t){return o(this,void 0,Promise,function(){return r(this,function(){return[2,new Promise(function(n,o){g.push({request:t,url:e,onSuccess:function(e){n(e)},onFailed:function(e){o(e)}})})]})})},n.post=function(e,t){return o(this,void 0,Promise,function(){return r(this,function(){return[2,new Promise(function(n,o){m.push({url:e,request:t,onSuccess:function(e){n(e)},onFailed:function(e){o(e)}})})]})})},cc._RF.pop()},{"../common":"common","../env":"env","../toast":"toast"}],index:[function(e,t,n){"use strict";cc._RF.push(t,"a5207Jww3lAFYfn0QwbFaVc","index");var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.Event=n.ResUtil=n.HTTP=n.showToast=void 0;var i=e("./event/events");n.Event=i;var c=e("./network/http");n.HTTP=c;var a=e("./resources");n.ResUtil=a,r(e("./common"),n);var s=e("./toast");Object.defineProperty(n,"showToast",{enumerable:!0,get:function(){return s.showToast}}),cc._RF.pop()},{"./common":"common","./event/events":"events","./network/http":"http","./resources":void 0,"./toast":"toast"}],"layer-manager":[function(e,t,n){"use strict";cc._RF.push(t,"a30fckNP/NPvJ7CbGTe2Vww","layer-manager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.layerEvent=n.LayerManager=void 0;var s=e("../common"),u=e("../common/event/typed-event"),l=e("../common/locker"),p=e("../components/base/base-layer"),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,v=f.disallowMultiple,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=null,t.currentLayer=null,t.swiftAnimaCount=0,t.isSwitching=!1,t}var o;return r(t,e),o=t,Object.defineProperty(t,"ins",{get:function(){var e=cc.director.getScene().getChildByName("Canvas");return e.getComponent(o)||e.getComponentInChildren(o)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.layers=[]},t.prototype.beforeSwitch=function(){return c(this,void 0,void 0,function(){return a(this,function(){return this.isSwitching?[2]:(this.isSwitching=!0,[2])})})},t.prototype.afterSwitch=function(){return c(this,void 0,void 0,function(){return a(this,function(){return this.isSwitching=!1,[2]})})},t.prototype.open=function(e,t){return c(this,void 0,Promise,function(){var o,r,i,u,l,f,d=this;return a(this,function(h){switch(h.label){case 0:return o=!1,this.swiftAnimaCount>0?(o=!0,[4,this.beforeSwitch()]):[3,2];case 1:h.sent(),h.label=2;case 2:return this.swiftAnimaCount++,[4,new Promise(function(t,n){cc.resources.load(e,cc.Prefab,function(e,o){e?n(e):t(o)})})];case 3:return r=h.sent(),cc.isValid(r)?(i=cc.instantiate(r),(u=i.getComponent(p.default))?(u.init(t),null!=(l=this.currentLayer)&&(l.getComponent(p.default).hide(),l.active=!1),(f=i.getComponent(cc.Widget))||(f=i.addComponent(cc.Widget)),f.isAlignHorizontalCenter=f.isAlignVerticalCenter=!1,f.isAlignRight=f.isAlignLeft=f.isAlignTop=f.isAlignBottom=!0,f.left=f.right=f.top=f.bottom=0,i.setParent(this.container),i.setSiblingIndex(this.container.childrenCount),[4,u.preLoad()]):(console.error("not found BaseLayer",e),[2,!1])):(console.warn("invalid prefab",e),[2,!1]);case 4:return h.sent(),o?[4,this.afterSwitch()]:[3,6];case 5:h.sent(),h.label=6;case 6:return u.show(),this.currentLayer=i,this.layers.push(i),n.layerEvent.emit({comp:u}),i.once(s.Event.BEFORE_NODE_REMOVE,function(e){return c(d,void 0,void 0,function(){var t,o,r,i,c;return a(this,function(a){switch(a.label){case 0:return[4,this.beforeSwitch()];case 1:return a.sent(),t=this.layers,-1==(o=t.findIndex(function(t){return t==e}))?[2]:(t.splice(o,1),0==(r=t.length)?(this.onNoLayerExists(),[2]):(i=t[r-1],c=i.getComponent(p.default),i.active||(i.active=!0,c.show()),n.layerEvent.emit({comp:c}),this.currentLayer=i,[4,this.afterSwitch()]));case 2:return a.sent(),[2]}})})}),[2]}})})},t.prototype.onNoLayerExists=function(){},i([h(cc.Node)],t.prototype,"container",void 0),i([l.touchLocker],t.prototype,"beforeSwitch",null),i([l.touchLocker],t.prototype,"afterSwitch",null),o=i([d,y("manager/layer-manager"),v],t)}(cc.Component);n.LayerManager=b,n.layerEvent=new u.TypedEvent,cc._RF.pop()},{"../common":"index","../common/event/typed-event":"typed-event","../common/locker":"locker","../components/base/base-layer":"base-layer"}],"linked-prefab":[function(e,t,n){"use strict";cc._RF.push(t,"5c4ba3tEg5PXpleEwDuudko","linked-prefab");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=cc._decorator,a=c.ccclass,s=c.executeInEditMode,u=c.property,l=c.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prefab=null,t._prefabNode=null,t}return r(t,e),Object.defineProperty(t.prototype,"prefab",{get:function(){return this._prefab},set:function(e){this._onPrefabChanged(this._prefab,e)},enumerable:!1,configurable:!0}),t.prototype._onPrefabChanged=function(e,t){if(e!=t&&(this._prefab=t,t)){var n=cc.instantiate(t);this._prefabNode=n,n&&(n._objFlags|=cc.Object.Flags.DontSave|cc.Object.Flags.LockedInEditor|cc.Object.Flags.HideInHierarchy,this.node.addChild(n,-1),this.node.width=n.width,this.node.height=n.height)}},t.prototype.onLoad=function(){this._onPrefabChanged(null,this._prefab)},t.prototype.getComponent=function(e){return this._prefabNode.getComponent(e)},i([u],t.prototype,"_prefab",void 0),i([u({type:cc.Prefab,visible:!0})],t.prototype,"prefab",null),i([a,s,l("ext/linked-prefab")],t)}(cc.Component);n.default=p,cc._RF.pop()},{}],locker:[function(e,t,n){"use strict";cc._RF.push(t,"37834vilIBCmow+NMCOxuNL","locker");var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],c=0,a=i.length;c<a;c++,r++)o[r]=i[c];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.onSceneChanged=n.touchLocker=n.disableTouch=n.isTouchLocked=n.unstashLocker=n.stashLocker=void 0;var r=e("./common");function i(e,t,n){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];t&&t.call.apply(t,o([e],r)),n&&n()}}var c=new Set,a=[];c.add=i(c,c.add,function(){s()}),c.delete=i(c,c.delete,function(){s()});var s=function(){var e=n.isTouchLocked();r.disableAllTouch(e)},u=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^r.randomInt(0,1e12)&15>>e/4).toString(16)})};function l(e){c.delete(e),a.forEach(function(t){t.delete(e)})}n.stashLocker=function(){a.push(new Set(c)),c.clear(),s()},n.unstashLocker=function(){c.clear(),a.length>0&&a.pop().forEach(function(e){c.add(e)}),s()},n.isTouchLocked=function(){return c.size>0},n.disableTouch=function(){var e=u();return c.add(e),function(){c.delete(e)}},n.touchLocker=function(e,t,n){var r=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=u();c.add(n);var a=r.call.apply(r,o([this],e));return a instanceof Promise?a.then(function(){l(n)}):l(n),this instanceof cc.Component&&(this.onDestroy=i(this,this.onDestroy,function(){l(n)})),a}},n.onSceneChanged=function(){r.resetGlobalBlockInputComp()},cc._RF.pop()},{"./common":"common"}],"object-pool":[function(e,t,n){"use strict";cc._RF.push(t,"591a5VZwTNFBI66zfx+X1jj","object-pool");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.objectPool=void 0;var i=e("../components/card"),c=e("../manager/resources"),a=function(){function e(e){this._pool=[],this._factory=e}return e.prototype.get=function(){return o(this,void 0,void 0,function(){var e,t;return r(this,function(n){switch(n.label){case 0:return this._pool.length>0?(e=this._pool.pop(),[3,4]):[3,1];case 1:return(t=this._factory())instanceof Promise?[4,t]:[3,3];case 2:return e=n.sent(),[3,4];case 3:e=t,n.label=4;case 4:return e instanceof cc.Node&&e.getComponent(i.CardComponent)&&e.getComponent(i.CardComponent).recycle(),[2,e]}})})},e.prototype.put=function(e){e instanceof cc.Node&&(e.removeFromParent(),cc.Tween.stopAllByTarget(e),e.cleanup()),this._pool.push(e)},e}();n.objectPool={cardPool:new a(function(){return o(void 0,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return[4,c.loadPrefab("prefab/components/Card")];case 1:return e=t.sent(),[2,cc.instantiate(e)]}})})}),actionLabelsPool:new a(function(){return o(void 0,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return[4,c.loadPrefab("prefab/components/ActionLabel")];case 1:return e=t.sent(),[2,cc.instantiate(e)]}})})})},cc._RF.pop()},{"../components/card":"card","../manager/resources":"resources"}],"panel-manager":[function(e,t,n){"use strict";cc._RF.push(t,"90028WwXTlFYYSQWtS3lhV5","panel-manager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.PanelManager=n.PanelShowResult=void 0;var s,u=e("../common/locker"),l=e("../components/base/base-panel"),p=e("./layer-manager"),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,v=f.disallowMultiple;(function(e){e[e.DONE=0]="DONE",e[e.FAILED=1]="FAILED",e[e.WAITING=2]="WAITING"})(s=n.PanelShowResult||(n.PanelShowResult={}));var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=null,t.mask=null,t}var n;return r(t,e),n=t,Object.defineProperty(t,"ins",{get:function(){var e=cc.director.getScene().getChildByName("Canvas");return e.getComponent(n)||e.getComponentInChildren(n)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.panelQueue=[],this.panelList=[],this.mask.active=!1},t.prototype.open=function(e,t,n){return c(this,void 0,Promise,function(){var o,r,i,c,f=this;return a(this,function(a){switch(a.label){case 0:return(n=null!=n?n:{}).inQueue&&this.panelQueue.length>0?(this.panelQueue.push({prefab:e,data:t,opt:n}),[2,{panelResult:s.WAITING}]):[4,new Promise(function(t,n){cc.resources.load(e,cc.Prefab,function(e,o){e?n(e):t(o)})})];case 1:return o=a.sent(),cc.isValid(o)?(r=cc.instantiate(o),(i=r.getComponent(l.default))?((c=r.getComponent(cc.Widget))||(c=r.addComponent(cc.Widget)),c.isAlignTop=c.isAlignBottom=c.isAlignLeft=c.isAlignRight=!0,c.top=c.bottom=c.left=c.right=0,c.alignMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,this.currentPanel=r,this.panelList.push({prefab:e,data:t,opt:n,node:r}),r.setParent(this.container),i.show(t),this.ensureMask(),p.layerEvent.emit({comp:i}),u.stashLocker(),[2,new Promise(function(e){i.setFinishCallback(function(t,n){f.currentPanel=null,t.parent=null,f.panelList.pop(),e({panelResult:s.DONE,values:n}),u.unstashLocker(),f.onNext(),f.scheduleOnce(function(){f.ensureMask(),p.layerEvent.emit({comp:null})},0)})})]):(console.warn("failed to load component of prefab",e),[2,{panelResult:s.FAILED}])):(console.warn("invalid prefab",e),[2,{panelResult:s.FAILED}])}})})},t.prototype.onNext=function(){if(null==this.currentPanel&&0!=this.panelQueue.length){var e=this.panelQueue.shift();this.open(e.prefab,e.data,e.opt)}},t.prototype.ensureMask=function(){var e=this.panelList,t=e.length,n=this.container.childrenCount,o=this.mask;if(t<=0)o.active=!1;else{var r=e[t-1].node;o.active=!0,r.active=!0,o.setSiblingIndex(n),r.setSiblingIndex(n)}},t.prototype.onMaskClick=function(){var e=this.panelList,t=e.length;if(!(t<=0)){var n=e[t-1],o=n.opt,r=n.node;o.clickMaskToClose&&r.getComponent(l.default).hide()}},i([h(cc.Node)],t.prototype,"container",void 0),i([h(cc.Node)],t.prototype,"mask",void 0),n=i([d,y("manager/panel-manager"),v],t)}(cc.Component);n.PanelManager=b,cc._RF.pop()},{"../common/locker":"locker","../components/base/base-panel":"base-panel","./layer-manager":"layer-manager"}],prefab:[function(e,t,n){"use strict";cc._RF.push(t,"45ab66RnohAYLtugJhqcuLB","prefab"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],resources:[function(e,t,n){"use strict";cc._RF.push(t,"88e87O9b1JAjrnunRmE3z8w","resources");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getResFromBundle=n.loadRes=n.loadRemote=n.loadLocalRes=n.loadAnimaClip=n.preloadPrefab=n.loadPrefab=void 0;var i=e("../common/env");function c(e,t){return o(this,void 0,Promise,function(){var n,o;return r(this,function(r){switch(r.label){case 0:return e?(n=cc.resources,[4,a("resources",e,t)]):[2];case 1:return(o=r.sent())?[2,o]:[2,new Promise(function(o,r){n.load(e,t,function(e,t){e?r(e):o(t)})})]}})})}function a(e,t,n){return o(this,void 0,Promise,function(){var o,i;return r(this,function(){return t&&(o=s(e,t,n))&&(i=cc.assetManager.assets.get(o))?[2,i]:[2,null]})})}function s(e,t,n){var o=cc.assetManager.bundles,r=function(e){if(!o.has(e))return null;var i=o.get(e).getInfoWithPath(t,n);return i?i.redirect?r(i.redirect):i.uuid:null};return r(e)}n.loadPrefab=function(e){return o(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,c(e,cc.Prefab)];case 1:return[2,t.sent()]}})})},n.preloadPrefab=function(e){return o(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){cc.resources.preload(e,cc.Prefab,function(){t()})})];case 1:return t.sent(),[2]}})})},n.loadAnimaClip=function(e){return o(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,c(e,cc.AnimationClip)];case 1:return[2,t.sent()]}})})},n.loadLocalRes=function(e){return c(e,cc.Asset)},n.loadRemote=function(e){return o(this,void 0,Promise,function(){return r(this,function(){return e?[2,new Promise(function(t,n){cc.assetManager.loadRemote(i.env.network.resourceURL+e,function(e,o){e?n(e):t(o)})})]:[2]})})},n.loadRes=c,n.getResFromBundle=a,cc._RF.pop()},{"../common/env":"env"}],router:[function(e,t,n){"use strict";cc._RF.push(t,"64ea7SsIWpGALStna0baNNE","router"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],"select-card-panel":[function(e,t,n){"use strict";cc._RF.push(t,"63b9foYcoZHS6y4t+e6EmRs","select-card-panel");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./components/base/base-panel"),u=e("./components/card-placeholder"),l=e("./components/ext/linked-prefab"),p=e("./common/object-pool"),f=e("./components/card"),d=e("./common/locker"),h=e("./game-logic/card-manager"),y=cc._decorator,v=y.ccclass,b=y.property,g=y.menu,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cardPlaceholdersRaw=[],t.cardPool=null,t.holdingCard=null,t.confirmButton=null,t.cards=[],t.selectedCard=null,t.selectHolder=null,t.holderCardMap=new Map,t.cardHolderMap=new Map,t}return r(t,e),Object.defineProperty(t.prototype,"cardPlaceholders",{get:function(){return this.cardPlaceholdersRaw.map(function(e){return e.getComponent(u.CardPlaceholderComponent)})},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.refreshButton(!1)},t.prototype.playEnterAnima=function(){return c(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return this.initHolders(6),[4,this.createCards(6)];case 1:return e.sent(),[4,this.playCardsAnimation(!0)];case 2:return e.sent(),this.addListeners(),[2]}})})},t.prototype.initHolders=function(e){for(var t=this.cardPlaceholders,n=0,o=t.length;n<o;n++){var r=t[n];r.holderIdx=n,r.setIsLocked(n>=e)}},t.prototype.createCards=function(e){return c(this,void 0,void 0,function(){var t,n,o,r;return a(this,function(i){switch(i.label){case 0:t=[h.cardConfigManager.getCard(1),h.cardConfigManager.getCard(2),h.cardConfigManager.getCard(3),h.cardConfigManager.getCard(4),h.cardConfigManager.getCard(5),h.cardConfigManager.getCard(6)],n=0,i.label=1;case 1:return n<e?[4,p.objectPool.cardPool.get()]:[3,4];case 2:o=i.sent(),(r=o.getComponent(f.CardComponent)).setIsVisible(!0),r.setCardConf(t[n%t.length]),this.cardPool.addChild(o),this.cards.push(r),o.opacity=0,i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.getCardX=function(e){return 50+50*e},t.prototype.playCardsAnimation=function(e){return void 0===e&&(e=!1),c(this,void 0,void 0,function(){var t,n,o,r,i;return a(this,function(c){switch(c.label){case 0:for(t=[],n=function(n,r){var i=o.cards[n],c=o.getCardX(n);e&&(i.node.x=c+150),i.node.setSiblingIndex(r-n-1),t.push(new Promise(function(e){cc.tween(i.node).delay(5*n/24).to(.7,{x:c,opacity:255},{easing:cc.easing.sineIn}).call(function(){e()}).start()}))},o=this,r=0,i=this.cards.length;r<i;r++)n(r,i);return[4,Promise.all(t)];case 1:return c.sent(),[2]}})})},t.prototype.addListeners=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},t.prototype.onHide=function(){this.removeListeners()},t.prototype.removeListeners=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},t.prototype.onTouchBegin=function(e){var t=this.cards;this.selectedCard=null;for(var n=0,o=t.length;n<o;n++){var r=t[n];if(r.hitTest(e)){this.selectedCard=r;break}}if(this.selectedCard){var i=this.selectedCard;i.showDescription(),i.beforeMoving(),i.setSelect(!0)}},t.prototype.onTouchMove=function(e){if(this.selectedCard){var t=this.selectedCard;t.hideDescription(),t.setMoving(e),this.selectHolder=this.getTouchedHolder(e)}},t.prototype.getTouchedHolder=function(e){for(var t=this.cardPlaceholders,n=null,o=0,r=t.length;o<r;o++)if(!t[o].isLocked&&t[o].hitTest(e)){n=t[o];break}return n},t.prototype.onTouchEnd=function(){return c(this,void 0,void 0,function(){var e,t,n,o;return a(this,function(){return this.selectedCard?(e=this.selectHolder,t=this.selectedCard,this.selectHolder=null,this.selectedCard=null,t.setSelect(!1),t.hideDescription(),e?(n=this.holderCardMap.get(e),o=this.cardHolderMap.get(t),this.holderCardMap.delete(o),this.cardHolderMap.delete(n),n&&o?(this.putCardToHolder(n,o),this.putCardToHolder(t,e)):n?(console.log("put card back to pool"),this.putCardBackToPool(n,t),this.putCardToHolder(t,e)):this.putCardToHolder(t,e)):t.afterMoving(!0),this.refreshButton(),[2]):[2]})})},t.prototype.putCardBackToPool=function(e,t){e.node.parent=this.cardPool;var n=t.getDataBeforeMoving(),o=n.pos,r=n.zIndex;e.node.setPosition(o),e.node.zIndex=r},t.prototype.putCardToHolder=function(e,t){var n=t.node.getPosition();t.node.convertToWorldSpaceAR(n,n),this.holdingCard.convertToNodeSpaceAR(n,n),e.node.parent=this.holdingCard,e.node.setPosition(n),this.holderCardMap.set(t,e),this.cardHolderMap.set(e,t)},t.prototype.refreshButton=function(e){void 0===e&&(e=!0);var t=6==this.getCards().length,n=this.confirmButton;if(cc.Tween.stopAllByTarget(n),!e)return n.opacity=t?255:0,void(n.y=t?0:-100);t?cc.tween(n).to(.7,{opacity:255,y:0},{easing:cc.easing.sineIn}).start():cc.tween(n).to(.7,{opacity:0,y:-50},{easing:cc.easing.sineIn}).start()},t.prototype.getCards=function(){for(var e=this.cardPlaceholders,t=this.holderCardMap,n=[],o=0,r=e.length;o<r;o++){var i=e[o];if(i.isLocked)break;var c=t.get(i);c&&c.conf&&n.push(c.conf)}return n},t.prototype.submit=function(){this.setReturnValue(this.getCards()),this.hide()},i([b([l.default])],t.prototype,"cardPlaceholdersRaw",void 0),i([b(cc.Node)],t.prototype,"cardPool",void 0),i([b(cc.Node)],t.prototype,"holdingCard",void 0),i([b(cc.Node)],t.prototype,"confirmButton",void 0),i([d.touchLocker],t.prototype,"onTouchEnd",null),i([v,g("panel/SelectCard")],t)}(s.default);n.default=m,cc._RF.pop()},{"./common/locker":"locker","./common/object-pool":"object-pool","./components/base/base-panel":"base-panel","./components/card":"card","./components/card-placeholder":"card-placeholder","./components/ext/linked-prefab":"linked-prefab","./game-logic/card-manager":"card-manager"}],sound:[function(e,t,n){"use strict";cc._RF.push(t,"1738bb0rj9PW4sQR3SWMTRI","sound");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.sound=n.Sound=void 0;var i,c=e("../manager/resources"),a=e("../user/userdata");(function(e){e.COMMON="sound/qubodup-hover2",e.BGM="sound/bgm",e.BLOCK="sound/swing",e.ATTACK="sound/sword-unsheathe",e.VENGEANCE="sound/sword-unsheathe4",e.STRENGTH="sound/random5"})(i=n.Sound||(n.Sound={}));var s=function(){function e(){this.isSharing=!1,this.isHiding=!1,this.delayKey=0,this.clips={}}return e.prototype.onSoundChange=function(){var e=this;clearTimeout(this.delayKey),this.delayKey=setTimeout(function(){clearTimeout(e.delayKey),e.delayKey=0,e.isSharing||e.isHiding?e.stopAll():e.resumeAll()},100)},e.prototype.resumeAll=function(){cc.audioEngine.resumeMusic(),cc.audioEngine.resumeAllEffects(),this.onBGMSwitchChange()},e.prototype.stopAll=function(){cc.audioEngine.stopMusic(),cc.audioEngine.stopAllEffects()},e.prototype.play=function(e,t){return void 0===t&&(t=1),o(this,void 0,void 0,function(){var n;return r(this,function(o){switch(o.label){case 0:return!1===a.userData.setting.getValue("bgm")?[2]:(t=Math.min(1,Math.max(0,t)),e instanceof cc.AudioClip?(n=e,[3,4]):[3,1]);case 1:return null==this.clips[e]?[3,2]:(n=this.clips[e],[3,4]);case 2:return[4,c.loadRes(e,cc.AudioClip)];case 3:n=o.sent(),this.clips[e]=n,o.label=4;case 4:return n?(cc.audioEngine.playEffect(n,!1),cc.audioEngine.setEffectsVolume(t),[2]):[2]}})})},e.prototype.playBGM=function(){return o(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return a.userData.setting.getValue("bgm")?(this.bgmID=0,[4,c.loadRes(i.BGM,cc.AudioClip)]):[2];case 1:return e=t.sent(),this.bgmID=cc.audioEngine.playMusic(e,!0),cc.audioEngine.setMusicVolume(.2),[2]}})})},e.prototype.onBGMSwitchChange=function(){var e=cc.audioEngine.getState(this.bgmID)!=cc.audioEngine.AudioState.ERROR;a.userData.setting.getValue("bgm")?e?cc.audioEngine.resumeMusic():this.playBGM():e&&cc.audioEngine.stopMusic()},e}();n.sound=new s,window.sound=n.sound,cc._RF.pop()},{"../manager/resources":"resources","../user/userdata":"userdata"}],"start-layer":[function(e,t,n){"use strict";cc._RF.push(t,"49265UPsQVO7JlnCTdqBk1n","start-layer");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./components/base/base-layer"),u=e("./manager/ui-manager"),l=cc._decorator,p=l.ccclass,f=l.menu,d=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.enterGame=function(){return c(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,u.UI.openLayer("prefab/layers/GameLayer",null)];case 1:return e.sent(),this.close(),[2]}})})},i([p,f("components/StartLayer")],t)}(s.default));n.default=d,cc._RF.pop()},{"./components/base/base-layer":"base-layer","./manager/ui-manager":"ui-manager"}],time:[function(e,t,n){"use strict";cc._RF.push(t,"2e98btN7bdEioEXk8VfzlyP","time"),Object.defineProperty(n,"__esModule",{value:!0}),n.formatTimeString=n.time=n.timeEvent=n.getFullDisplayDateTime=n.getFullDisplayTime=n.getFullDisplayDate=n.addZero=n.isToday=n.isSameDay=void 0;var o=e("./event/typed-event"),r=function(){function e(){this.weekDay=-1,this._cachedZoneOffset=null,this.dayChangeT=-1,this.initd=!1}return e.prototype.sync=function(e){var t,n;null!=e&&null!=e.serverTime?(this.serverStartT=1e3*e.serverTime,this.clientStartT=Date.now(),this.weekDay=null!==(t=e.weekDay)&&void 0!==t?t:-1,this.dayChangeT=null!==(n=e.dayChangeT)&&void 0!==n?n:-1):console.warn("invalid server time")},Object.defineProperty(e.prototype,"serverTime",{get:function(){var e=Math.floor((this.serverStartT+Date.now()-this.clientStartT)/1e3);if(isNaN(e))return Math.floor(Date.now()/1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeZoneOffset",{get:function(){if(null==this._cachedZoneOffset){var e=new Date,t=Math.round(e.getTimezoneOffset()/6);this._cachedZoneOffset=-t/10}return this._cachedZoneOffset},enumerable:!1,configurable:!0}),e.prototype.startGlobalTimer=function(e){var t=this;e.schedule(function(e){var o=n.time.serverTime,r=o>t.dayChangeT&&t.dayChangeT>0;r&&(t.dayChangeT+=93600),n.timeEvent.emit({now:o,dt:e,dayChange:r})},1,cc.macro.REPEAT_FOREVER)},e}();function i(e,t){var n=new Date(1e3*e),o=new Date(1e3*t);return n.getFullYear()==o.getFullYear()&&n.getMonth()==o.getMonth()&&n.getDate()==o.getDate()}function c(e){return e<10?"0"+e:e+""}function a(e){var t=new Date(1e3*e);return t.getFullYear()+"/"+c(t.getMonth()+1)+"/"+c(t.getDate())}function s(e){var t=new Date(1e3*e);return c(t.getHours())+":"+c(t.getMinutes())+":"+c(t.getSeconds())}n.isSameDay=i,n.isToday=function(e){return i(n.time.serverTime,e)},n.addZero=c,n.getFullDisplayDate=a,n.getFullDisplayTime=s,n.getFullDisplayDateTime=function(e){return a(e)+" "+s(e)},n.timeEvent=new o.TypedEvent,n.time=new r,window.time=n.time,n.formatTimeString=function(e,t){if(e<=0)return t?"00:00:00":"00:00";var n=e%60,o=(e=(e-n)/60)%60,r=(e-o)/60,i="";return(r>0||t)&&(r<10&&(r="0"+r),i+=r+":"),o<10&&(o="0"+o),n<10&&(n="0"+n),(i+=o+":")+n},cc._RF.pop()},{"./event/typed-event":"typed-event"}],toast:[function(e,t,n){"use strict";cc._RF.push(t,"e014bmTxNhIlpPak2KPWnDC","toast");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.showToast=void 0;var i=e("../manager/resources");n.showToast=function(e,t){return void 0===t&&(t=3e3),o(this,void 0,void 0,function(){var n,o,c,a,s,u,l,p,f,d,h;return r(this,function(r){switch(r.label){case 0:return null==e||""==e?[2]:(n=cc.director.getScene().getComponentInChildren(cc.Canvas),(o=n.node.getChildByName("Toast"))&&o.destroy(),[4,i.loadLocalRes("ui/guide/common_txt_bg")]);case 1:return c=r.sent(),(a=new cc.Node("Toast")).opacity=0,s=new cc.Node("LabelNode"),(u=s.addComponent(cc.Label)).enableBold=!0,u.fontSize=50,u.lineHeight=50,s.addComponent(cc.LabelOutline).color=cc.Color.BLACK,s.getComponent(cc.LabelOutline).width=4,u.string=e,(l=a.addComponent(cc.Layout)).resizeMode=cc.Layout.ResizeMode.NONE,l.paddingLeft=30,l.paddingRight=30,l.paddingTop=25,l.paddingBottom=20,(p=a.addComponent(cc.Sprite)).type=cc.Sprite.Type.SLICED,p.spriteFrame=c,a.addChild(s),n.node.addChild(a),f=cc.callFunc(function(){cc.tween(a).to(.3,{opacity:255}).start()}),d=cc.callFunc(function(){var e=setTimeout(function(){a.destroy(),clearTimeout(e)},t)},this),h=cc.sequence(f,d),a.runAction(h),[2]}})})},cc._RF.pop()},{"../manager/resources":"resources"}],"typed-event":[function(e,t,n){"use strict";cc._RF.push(t,"3455cEfP7NFLoL+iGdgHa17","typed-event"),Object.defineProperty(n,"__esModule",{value:!0}),n.TypedEvent=void 0;var o=function(){function e(){var e=this;this.listeners=[],this.listenersOnce=[],this.on=function(t){return e.listeners.push(t),{dispose:function(){return e.off(t)}}},this.once=function(t){e.listenersOnce.push(t)},this.off=function(t){var n=e.listeners.indexOf(t);n>-1&&e.listeners.splice(n,1)},this.emit=function(t){e.listeners.forEach(function(e){return e(t)}),e.listenersOnce.forEach(function(e){return e(t)}),e.listenersOnce=[]},this.pipe=function(t){return e.on(function(e){return t.emit(e)})}}return e.prototype.reset=function(){this.listeners=[]},e}();n.TypedEvent=o,cc._RF.pop()},{}],"ui-manager":[function(e,t,n){"use strict";cc._RF.push(t,"d42c6RD181OUoUo3aiLdgnY","ui-manager");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{s(o.next(e))}catch(t){i(t)}}function a(e){try{s(o.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.UI=void 0;var i=e("../components/base/base-layer"),c=e("../components/base/base-panel"),a=e("./layer-manager"),s=e("./panel-manager"),u=function(){function e(){}return e.openPanel=function(e,t,n){return o(this,void 0,Promise,function(){return r(this,function(){return[2,s.PanelManager.ins.open(e,t,n)]})})},e.openLayer=function(e,t){return o(this,void 0,Promise,function(){return r(this,function(){return[2,a.LayerManager.ins.open(e,t)]})})},e.getTopView=function(){var e=s.PanelManager.ins.panelList;if(e.length>0){var t=e[e.length-1];if(t.node)return t.node.getComponent(c.default)}var n=a.LayerManager.ins.layers;if(n.length>0)return n[n.length-1].getComponent(i.default)},e.getTopLayer=function(){var e=a.LayerManager.ins.layers;if(e.length>0)return e[e.length-1].getComponent(i.default)},e.getTopPanel=function(){var e=s.PanelManager.ins.panelList;if(e.length>0)return e[e.length-1].node},e.getPanelByName=function(e){for(var t=s.PanelManager.ins.panelList,n=0;n<t.length;++n)if(t[n].node.name==e)return t[n].node;return null},e}();n.UI=u,cc._RF.pop()},{"../components/base/base-layer":"base-layer","../components/base/base-panel":"base-panel","./layer-manager":"layer-manager","./panel-manager":"panel-manager"}],userdata:[function(e,t,n){"use strict";cc._RF.push(t,"f4398zebxtHw5d+AKiZt48o","userdata"),Object.defineProperty(n,"__esModule",{value:!0}),n.userData=void 0;var o=function(){function e(){this.settings={bgm:!0},this.proxy=new Proxy(this.settings,{set:function(e,t,n){return e[t]=n,console.log("Set "+String(t)+" to "+n),!0}}),this.load()}return e.prototype.save=function(){localStorage.setItem("user_settings",JSON.stringify(this.settings))},e.prototype.load=function(){var e=this,t=localStorage.getItem("user_settings");if(t){var n=JSON.parse(t);Object.keys(n).forEach(function(t){e.settings[t]=n[t]})}},e.prototype.getValue=function(e){return this.proxy[e]},e.prototype.setValue=function(e,t){this.proxy[e]=t,this.save()},e}(),r=function(){function e(){this.setting=new o,this.cards=[]}return e.prototype.load=function(){var e=localStorage.getItem("user_data");if(e){var t=JSON.parse(e);this.cards=t.cards}},e.prototype.save=function(){var e={cards:this.cards},t=JSON.stringify(e);localStorage.setItem("user_data",t)},e.prototype.loadDebug=function(){this.cards=[{id:1,level:1},{id:2,level:1},{id:1,level:2}]},e}();n.userData=new r,cc._RF.pop()},{}]},{},["Main","common","env","events","typed-event","index","locker","http","router","object-pool","sound","time","toast","action-label","bar","base-layer","base-panel","card-deck","card-placeholder","card","linked-prefab","prefab","finish-layer","game-layer","card-data-type","card-manager","command-parser","global","layer-manager","panel-manager","resources","ui-manager","select-card-panel","start-layer","userdata"]);