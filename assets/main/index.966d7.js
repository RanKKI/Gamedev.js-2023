window.__require=function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){var s=a.split("/");if(s=s[s.length-1],!t[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<r.length;a++)o(r[a]);return o}({Main:[function(e,t,n){"use strict";cc._RF.push(t,"27ce8S4IPNMBLINswmKXlTv","Main");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./manager/ui-manager"),u=e("./user/userdata"),l=e("./game-logic/card-manager"),p=cc._decorator,f=p.ccclass,d=p.menu,h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.start=function(){return a(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return console.log("Main start"),[4,l.cardConfigManager.loadConfigs()];case 1:return e.sent(),[4,this.loadUserData()];case 2:return e.sent(),[4,s.UI.openLayer("prefab/layers/GameLayer",null)];case 3:return e.sent(),[2]}})})},t.prototype.loadUserData=function(){return a(this,void 0,void 0,function(){return c(this,function(){return console.log("load user data"),u.userData.load(),console.debug("load debug data"),u.userData.loadDebug(),console.log("finish load user data"),[2]})})},i([f,d("components/Main")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"./game-logic/card-manager":"card-manager","./manager/ui-manager":"ui-manager","./user/userdata":"userdata"}],bar:[function(e,t,n){"use strict";cc._RF.push(t,"6d7d4JfuIFIkLULRZWhl/NR","bar");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.BarComponent=void 0;var a=cc._decorator,c=a.ccclass,s=a.property,u=a.menu,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mask=null,t._value=0,t}return o(t,e),t.prototype.start=function(){this.setPercentage(1,!1)},t.prototype.setPercentage=function(e,t){this._value=e;var n=5+(this.node.width-10)*e;t?(cc.Tween.stopAllByTarget(this.mask),cc.tween(this.mask).to(.2,{width:n}).start()):this.mask.width=n},i([s(cc.Node)],t.prototype,"mask",void 0),i([c,u("components/Bar")],t)}(cc.Component);n.BarComponent=l,cc._RF.pop()},{}],"base-layer":[function(e,t,n){"use strict";cc._RF.push(t,"6e5ecjPvvxFMY09MKOcAVES","base-layer");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../common"),u=cc._decorator.ccclass,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="",t}return o(t,e),t.prototype.init=function(e){this.options=e},t.prototype.preLoad=function(){return a(this,void 0,void 0,function(){return c(this,function(){return[2]})})},t.prototype.show=function(){this.onShow()},t.prototype.onShow=function(){},t.prototype.hide=function(){this.onHide()},t.prototype.onHide=function(){},t.prototype.close=function(){var e=this.node;e.emit(s.Event.BEFORE_NODE_REMOVE,e),e.active=!1,e.removeFromParent(),e.emit(s.Event.ON_NODE_REMOVE,e),e.parent=null},i([u],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../../common":"index"}],"base-panel":[function(e,t,n){"use strict";cc._RF.push(t,"ad874a95yhBy6VubdYIWjDH","base-panel");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../common/common"),c=cc._decorator,s=c.ccclass,u=c.property,l=c.disallowMultiple,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.content=null,t.animDuration=.5,t.finishCallback=null,t.returnValue=null,t}return o(t,e),t.prototype.show=function(e,t){void 0===t&&(t=this.animDuration),this.options=e,this.playEnterAnima(t),this.init(this.options),this.updateDisplay(this.options)},t.prototype.playEnterAnima=function(e){var t=this,n=this.content;this.node.active=!0,n.active=!0,n.scale=.5,n.opacity=0,cc.tween(n).to(e,{scale:1,opacity:255},{easing:"backOut"}).call(function(){t.onShow&&t.onShow()}).start()},t.prototype.hide=function(e){var t=this;a.tempDisableButton(e,1),a.disableTouch(this.node,!0);var n=this.node,r=cc.tween(this.content).to(.125,{scale:1.1},{easing:cc.easing.quadOut}).parallel(cc.tween(this.content).to(.25,{scale:.5},{easing:cc.easing.quadIn}),cc.tween(this.content).delay(1/24).to(.25,{opacity:0})).call(function(){n.active=!1,t.onHide&&t.onHide(),a.disableTouch(t.node,!1),t.finishCallback&&t.finishCallback(n,t.returnValue)});return new Promise(function(e){r.call(function(){e()}).start()})},t.prototype.init=function(){},t.prototype.updateDisplay=function(){},t.prototype.onShow=function(){},t.prototype.onHide=function(){},t.prototype.setFinishCallback=function(e){this.finishCallback=e},t.prototype.setReturnValue=function(e){this.returnValue=e},i([u(cc.Node)],t.prototype,"content",void 0),i([s,l],t)}(cc.Component);n.default=p,cc._RF.pop()},{"../../common/common":"common"}],"card-data-type":[function(e,t){"use strict";cc._RF.push(t,"7d89fKaOzlJFZ4px5FMbFdm","card-data-type"),cc._RF.pop()},{}],"card-deck":[function(e,t,n){"use strict";cc._RF.push(t,"66db1/pPZtAXp/6n44p2OY3","card-deck");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},u=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};Object.defineProperty(n,"__esModule",{value:!0}),n.CardDeckComponent=n.CardDeckMode=void 0;var l,p=e("../common"),f=e("../common/object-pool"),d=e("../game-logic/card-manager"),h=e("../manager/ui-manager"),y=e("./bar"),v=e("./card"),g=e("./ext/linked-prefab"),b=cc._decorator,m=b.ccclass,_=b.property,w=b.menu;(function(e){e[e.Player=0]="Player",e[e.Computer=1]="Computer"})(l=n.CardDeckMode||(n.CardDeckMode={}));var C={None:0,UsedStrength:2,HPChanged:4},P={block:0,strength:0,hp:40},O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.deck=null,t.cards=[],t.mode=null,t.round=0,t.hpBarPrefab=null,t.playerAttributes=i({},P),t.effects=[],t.cardsPool=[],t.nextCardIdx=0,t.cardPoolNode=null,t.triggers=C.None,t}return o(t,e),t.prototype.setMode=function(e){this.mode!==e&&(this.mode=e)},Object.defineProperty(t.prototype,"selfName",{get:function(){return this.mode===l.Player?"Player":"Computer"},enumerable:!1,configurable:!0}),t.prototype.setRound=function(e){this.round=e},t.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,u(["["+this.round+"]["+this.selfName+"]"],e))},t.prototype.start=function(){},t.prototype.createCard=function(){return c(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<5?[4,this.drawCard()]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.reorderCard=function(e){return void 0===e&&(e=!0),c(this,void 0,void 0,function(){var t,n,r,o,i;return s(this,function(a){switch(a.label){case 0:for(t=[],n=function(n,o){var i=r.cards[n],a=r.getCardX(n);i.node.setSiblingIndex(o-n-1),e?t.push(new Promise(function(e){cc.tween(i.node).to(.2,{x:a}).call(function(){e()}).start()})):i.node.x=a},r=this,o=0,i=this.cards.length;o<i;o++)n(o,i);return[4,Promise.all(t)];case 1:return a.sent(),[2]}})})},t.prototype.getCardX=function(e){return 50+20*e},Object.defineProperty(t.prototype,"hpBar",{get:function(){return this.hpBarPrefab.getComponent(y.BarComponent)},enumerable:!1,configurable:!0}),t.prototype.getAttributes=function(){return this.playerAttributes},t.prototype.resetAttributes=function(){this.playerAttributes=i({},P),this.triggers=C.None},t.prototype.isDead=function(){return this.playerAttributes.hp<=0},t.prototype.addHP=function(e){if(0!=e){this.playerAttributes.hp+=e;var t=this.playerAttributes.hp;this.hpBar.setPercentage(t/40,!0),this.log("HP "+(e>0?"+":"-")+Math.abs(e)+", HP: "+t)}},t.prototype.setHP=function(e){this.playerAttributes.hp=e,this.hpBar.setPercentage(e/40)},t.prototype.resetCardsPool=function(){this.cardsPool=[],this.nextCardIdx=0},t.prototype.getNextCardConf=function(){if(this.cardsPool.length<=0)throw new Error("\u5361\u6c60\u4e3a\u7a7a");var e=this.cardsPool[this.nextCardIdx%this.cardsPool.length];return this.nextCardIdx++,e},t.prototype.prepare=function(e){return c(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.resetCardsPool(),this.cardsPool=u(e),this.resetAttributes(),this.effects=[],[4,this.createCard()];case 1:return t.sent(),this.log(this.cards.map(function(e){return e.conf.name})),[2]}})})},t.prototype.drawCard=function(){return c(this,void 0,void 0,function(){var e,t,n;return s(this,function(r){switch(r.label){case 0:return[4,f.objectPool.cardPool.get()];case 1:return(e=r.sent()).setPosition(this.cardPoolNode.node.getPosition()),(t=e.getComponent(v.CardComponent)).setIsVisible(this.mode===l.Player),this.deck.addChild(e),this.cards.push(t),n=this.getNextCardConf(),t.setCardConf(n),[4,this.reorderCard(!0)];case 2:return r.sent(),[2]}})})},t.prototype.useCard=function(e){return c(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=[this.reorderCard(),new Promise(function(t){cc.tween(e.node).to(.2,{opacity:0}).call(function(){e.node.parent=null,f.objectPool.cardPool.put(e.node),t()}).start()})],[4,Promise.all(t)];case 1:return n.sent(),[2]}})})},t.prototype.play=function(e){return c(this,void 0,Promise,function(){var t,n,r;return s(this,function(o){switch(o.label){case 0:return this.needsSkip()?(this.log("Skip this turn"),[2,[]]):(this.beforeUseCard(),t=this.cards.splice(0,1)[0],this.log("Play card",t.conf.name),n=cc.v2(0,50),h.UI.getTopLayer().node.convertToWorldSpaceAR(n,n),t.node.parent.convertToNodeSpaceAR(n,n),t.beforeMoving(),t.setMoving(),[4,Promise.all([new Promise(function(e){cc.tween(t.node).to(.8,{x:n.x,y:n.y},{easing:cc.easing.sineIn}).call(function(){e()}).start()}),p.sleep(.4).then(function(){return t.setIsVisible(!0,!0)})])]);case 1:return o.sent(),[4,Promise.all([this.useCard(t),this.drawCard()])];case 2:return o.sent(),r=d.cardConfigManager.convertToCommands(t.conf),r=this.applySelfCommands(r,e),r=this.applyEffectBeforeUseCard(r,e),this.afterUseCard(),[2,r]}})})},t.prototype.addTrigger=function(e){this.triggers|=e},t.prototype.removeTrigger=function(e){this.triggers&=~e},t.prototype.isTrigger=function(e){return 0!=(this.triggers&e)},t.prototype.beforeUseCard=function(){this.playerAttributes.strength>0&&(this.playerAttributes.strength=Math.max(0,this.playerAttributes.strength-1),this.log("reduce strength by 1, now = ",this.playerAttributes.strength))},t.prototype.afterUseCard=function(){this.isTrigger(C.UsedStrength)&&(this.removeTrigger(C.UsedStrength),this.log("Used strength, reset strength to 0"),this.playerAttributes.strength=0)},t.prototype.applyEffectBeforeUseCard=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],o=this.playerAttributes.strength,i=r.value;"attack"===r.type&&o>0&&(r.value+=o,this.addTrigger(C.UsedStrength),this.log("Apply strength",o,", increased attack from "+i+" to "+r.value))}return e},t.prototype.applySelfCommands=function(e,t){var n=["block","block_strength","strength","vengeance"],r=this.findCommandsByType(e,n),o=this.callCommands(r,t);return u(e.filter(function(e){return!n.includes(e.type)}),o)},t.prototype.needsSkip=function(){var e=this.effects.find(function(e){return"skipturn"===e.type});return!!e&&(e.value--,e.value<=0&&this.effects.splice(this.effects.indexOf(e),1),!0)},t.prototype.execute=function(e,t){return c(this,void 0,void 0,function(){var n,r;return s(this,function(){return n=i({},this.playerAttributes),r=this.findCommandsByType(e,"effect"),e=(e=this.applyEffects(r,e)).filter(function(e){return"effect"!==e.type}),this.callCommands(e,t),this.playerAttributes.hp!=n.hp?this.addTrigger(C.HPChanged):this.removeTrigger(C.HPChanged),[2]})})},t.prototype.callCommands=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r],a=this["execute_"+i.type];if(a){var c=a.call(this,i,t);c&&n.push(c)}else this.log("not found execute for command",i.type)}return n},t.prototype.execute_attack=function(e){var t=e.value,n=this.playerAttributes.block;n>0&&(n>=t?(n-=t,t=0):(t-=n,n=0)),this.playerAttributes.block=n,t!=e.value?this.log("attacked by",t,"damage","(origin damage = "+e.value+")"):this.log("attacked by",t,"damage"),this.addHP(-t)},t.prototype.execute_skipturn=function(e){this.effects.push(e)},t.prototype.execute_block=function(e){var t=Math.max(0,e.value);this.log("add block",t),this.playerAttributes.block+=t},t.prototype.execute_block_strength=function(e,t){var n=Math.max(0,e.value+t.strength);this.log("add block",n),this.playerAttributes.block+=n},t.prototype.execute_strength=function(e){this.log("add strength",e.value),this.playerAttributes.strength+=e.value},t.prototype.execute_vengeance=function(){var e=this.isTrigger(C.HPChanged)?6:3;return this.log("Vengeance triggered, deal "+e+"  damage to enemy"),{type:"attack",value:e}},t.prototype.findCommandsByType=function(e,t){var n=Array.isArray(t)?t:[t];return e.filter(function(e){return n.findIndex(function(t){return t==e.type})>=0})},t.prototype.applyBuff=function(e,t){var n=e.value;"percent"===e.valueType&&(n=t.value*e.value);var r=e.value+("percent"==e.valueType?"%":"");this.log("use effect on",e.on,"value",n,"raw",r),t.value+=n},t.prototype.applyEffects=function(e,t){for(var n=function(n){for(var o=t[n],i=e.filter(function(e){return e.buff.on===o.type}),a=0,c=i.length;a<c;a++){var s=i[a];if(!(p.random(0,1)>s.value)){var u=s.buff;r.applyBuff(u,o)}}},r=this,o=0,i=t.length;o<i;o++)n(o);return t},a([_(cc.Node)],t.prototype,"deck",void 0),a([_(g.default)],t.prototype,"hpBarPrefab",void 0),a([_(g.default)],t.prototype,"cardPoolNode",void 0),a([m,w("components/CardDeck")],t)}(cc.Component);n.CardDeckComponent=O,cc._RF.pop()},{"../common":"index","../common/object-pool":"object-pool","../game-logic/card-manager":"card-manager","../manager/ui-manager":"ui-manager","./bar":"bar","./card":"card","./ext/linked-prefab":"linked-prefab"}],"card-manager":[function(e,t,n){"use strict";cc._RF.push(t,"554f8t/sZ5JTr/VIAzTNVaA","card-manager");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.cardConfigManager=void 0;var i=e("../manager/resources"),a=e("./command-parser"),c=function(){function e(){}return e.prototype.loadJSONConfig=function(e){return r(this,void 0,void 0,function(){return o(this,function(){return[2,i.loadLocalRes("configs/"+e)]})})},e.prototype.getCard=function(e){var t=this.cardConfig[e];if(!t)throw new Error("card not found: "+e);return t},e.prototype.loadCardConfig=function(){return r(this,void 0,void 0,function(){var e,t,n,r,i,a;return o(this,function(o){switch(o.label){case 0:return console.log("load card config"),[4,this.loadJSONConfig("card")];case 1:if(!(e=o.sent())||!e.json)throw new Error("load card config failed");for(t=e.json,this.cardConfig={},n=0,r=t;n<r.length;n++)i=r[n],a={id:i.id,name:i.name,description:i.description,resource:i.resource,effects:Array.isArray(i.effects)?i.effects:[i.effects]},this.cardConfig[a.id]=a;return console.log("load card config done"),[2]}})})},e.prototype.validateCards=function(){return r(this,void 0,void 0,function(){var e,t;return o(this,function(){if(e=Object.keys(this.cardConfig),t=new Set(e),e.length!==t.size)throw new Error("duplicate card id");return[2]})})},e.prototype.loadConfigs=function(){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return console.log("load configs"),[4,Promise.all([this.loadCardConfig()])];case 1:return e.sent(),this.validateCards(),console.log("load configs done"),[2]}})})},e.prototype.convertToCommands=function(e){if(null==e.effects)throw new Error("no effect for card "+e.id);for(var t=[],n=0,r=e.effects;n<r.length;n++){var o=r[n];t.push(a.cmdParser.parse(o))}return t},e}();n.cardConfigManager=new c,cc._RF.pop()},{"../manager/resources":"resources","./command-parser":"command-parser"}],"card-placeholder":[function(e,t,n){"use strict";cc._RF.push(t,"af677a+djJBToI+2FHaDYPf","card-placeholder");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.CardPlaceholderComponent=void 0;var a=e("../common"),c=cc._decorator,s=c.ccclass,u=c.property,l=c.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.collider=null,t.lockNode=null,t.isLocked=!1,t.holderIdx=0,t}return o(t,e),t.prototype.setIsLocked=function(e){this.isLocked=e,this.lockNode.active=e},t.prototype.hitTest=function(e){var t=cc.Vec2.ZERO;return t=e instanceof cc.Event.EventTouch?a.getLocalTouchPos(e,this.node):e,cc.Intersection.pointInPolygon(t,this.collider.points)},i([u(cc.PolygonCollider)],t.prototype,"collider",void 0),i([u(cc.Node)],t.prototype,"lockNode",void 0),i([s,l("components/CardPlaceholder")],t)}(cc.Component);n.CardPlaceholderComponent=p,cc._RF.pop()},{"../common":"index"}],card:[function(e,t,n){"use strict";cc._RF.push(t,"3362fug6qFPhrfwILAXG8W0","card");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.CardComponent=void 0;var s=e("../common"),u=e("../manager/resources"),l=cc._decorator,p=l.ccclass,f=l.property,d=l.menu,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cardNode=null,t.cardBg=null,t.selected=null,t.collider=null,t.cardSprite=null,t.isVisible=!1,t.bSelected=!1,t.currentAngle=0,t.currentPos=null,t.currentZIndex=0,t.conf=null,t}return o(t,e),t.prototype.start=function(){this.setIsVisible(this.isVisible),this.setSelect(this.bSelected)},t.prototype.setIsVisible=function(e,t){return a(this,void 0,void 0,function(){var n,r,o=this;return c(this,function(i){switch(i.label){case 0:return e==this.isVisible?[2]:(this.isVisible=e,this.cardNode.active=e,this.cardBg.active=!e,t&&null!=t?(this.cardNode.opacity=e?0:255,this.cardBg.opacity=e?255:0,n=new Promise(function(t){cc.tween(o.cardNode).to(.4,{opacity:e?255:0},{easing:cc.easing.sineIn}).call(function(){t(),o.cardNode.active=e}).start()}),r=new Promise(function(t){cc.tween(o.cardBg).to(.2,{opacity:e?0:255}).call(function(){o.cardBg.active=!e,t()}).start()}),[4,Promise.all([n,r])]):[2]);case 1:return i.sent(),[2]}})})},t.prototype.hitTest=function(e){var t=cc.Vec2.ZERO;return t=e instanceof cc.Event.EventTouch?s.getLocalTouchPos(e,this.node):e,cc.Intersection.pointInPolygon(t,this.collider.points)},t.prototype.getDataBeforeMoving=function(){return{pos:this.currentPos,zIndex:this.currentZIndex}},t.prototype.beforeMoving=function(){null!=this.node&&(this.currentAngle=this.node.angle,this.currentPos=this.node.position.clone(),this.currentZIndex=this.node.getSiblingIndex())},t.prototype.setSelect=function(e){this.selected.active=e,this.bSelected=e},t.prototype.setMoving=function(e){void 0===e&&(e=null),this.node.angle=0,this.node.setSiblingIndex(this.node.parent.childrenCount-1),e&&this.updateMoving(e)},t.prototype.updateMoving=function(e){var t=e.getLocation();cc.Camera.main.getScreenToWorldPoint(t,t),this.node.parent.convertToNodeSpaceAR(t,t),this.node.setPosition(t)},t.prototype.afterMoving=function(e){e&&(this.node.angle=this.currentAngle,this.node.position=this.currentPos,this.node.setSiblingIndex(this.currentZIndex))},t.prototype.setCardConf=function(e){var t=this;this.conf=e,u.loadRes("ui/card/"+e.resource,cc.SpriteFrame).then(function(e){t.cardSprite.spriteFrame=e})},t.prototype.recycle=function(){this.setIsVisible(!1),this.setSelect(!1),this.node.angle=0,this.node.position=cc.Vec3.ZERO,this.node.setSiblingIndex(0),this.currentAngle=0,this.currentPos=null,this.currentZIndex=0,this.node.opacity=255,this.cardNode.opacity=255,this.cardBg.opacity=255,this.conf=null},i([f(cc.Node)],t.prototype,"cardNode",void 0),i([f(cc.Node)],t.prototype,"cardBg",void 0),i([f(cc.Node)],t.prototype,"selected",void 0),i([f(cc.PolygonCollider)],t.prototype,"collider",void 0),i([f(cc.Sprite)],t.prototype,"cardSprite",void 0),i([p,d("components/Card")],t)}(cc.Component);n.CardComponent=h,cc._RF.pop()},{"../common":"index","../manager/resources":"resources"}],"command-parser":[function(e,t,n){"use strict";cc._RF.push(t,"43abbNixjhM2LC9mGLXI6ar","command-parser"),Object.defineProperty(n,"__esModule",{value:!0}),n.cmdParser=void 0;var r=function(){function e(){var e=this;this.parsers={};for(var t=0,n=["attack","energy","skipturn","block","strength","block_strength","vengeance"];t<n.length;t++){var r=n[t];this.parsers[r]=function(t){return e.parseNormalCommand(t)}}this.parsers.effect=function(t){return e.parseEffect(t)}}return e.prototype.parsePercent=function(e){return e.endsWith("%")?parseInt(e.slice(0,e.length-1))/100:parseInt(e)},e.prototype.getValueType=function(e){return e.endsWith("%")?"percent":"number"},e.prototype.parseNormalCommand=function(e){return 1==e.length?{type:e[0],value:0}:{type:e[0],value:parseInt(e[1])}},e.prototype.parseEffect=function(e){return{type:"effect",value:this.parsePercent(e[1]),buff:{type:"buff",on:e[3],value:this.parsePercent(e[2]),valueType:this.getValueType(e[2])}}},e.prototype.parse=function(e){var t=e.split(" "),n=t[0],r=this.parsers[n];if(!r)throw new Error("unknown command type: "+n);return r(t)},e}();n.cmdParser=new r,cc._RF.pop()},{}],common:[function(e,t,n){"use strict";cc._RF.push(t,"bdd80aPButDZpSjcYdhHeUq","common");var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};Object.defineProperty(n,"__esModule",{value:!0}),n.getLocalTouchPos=n.isPord=n.mapRange=n.clamp=n.deepClone=n.mergeDeep=n.isObject=n.randomChoice=n.randomChoiceOne=n.shuffleArr=n.sleep=n.compareVersion=n.random=n.randomInt=n.disableTouch=n.tempDisableButton=n.disableBtn=n.resetGlobalBlockInputComp=n.disableAllTouch=n.showNode=n.toThousands=n.curCanvas=n.getScreenHeight=n.getScreenWidth=void 0,n.getScreenWidth=function(){return cc.view.getCanvasSize().width},n.getScreenHeight=function(){return cc.view.getCanvasSize().height},n.curCanvas=function(){var e=cc.director.getScene();return cc.find("Canvas",e)},n.toThousands=function(e){return void 0===e&&(e=0),e.toString().replace(/\d+/,function(e){return e.replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")})},n.showNode=function(e,t,n,r){void 0===r&&(r=0),n&&(e.scale=0,cc.tween(e).delay(r).to(n,{scale:1}).start()),null!=e&&(e.active=t)};var o=null;function i(e,t){e.interactable=!t}function a(e){for(var t=e.length-1;t>=0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[n];e[n]=e[t],e[t]=r}return e}function c(e,t){return a(Object.assign([],e)).slice(0,t)}function s(e){return e&&"object"==typeof e&&!Array.isArray(e)}function u(e,t,n){return e<t?t:e>n?n:e}n.disableAllTouch=function(e){if(null==o){var t=cc.director.getScene().getComponentInChildren(cc.Canvas).node.children,n=t[t.length-1];o=n.getComponent(cc.BlockInputEvents)}o?o.enabled=e:console.error("globalBlockInputComp is null")},n.resetGlobalBlockInputComp=function(){o=null},n.disableBtn=i,n.tempDisableButton=function(e,t){if(void 0===t&&(t=0),null!=e){e instanceof cc.Event.EventTouch&&(e=e.target);var n=null;if(e instanceof cc.Button?n=e:e instanceof cc.Node&&(n=e.getComponent(cc.Button)),null!=n){var r=function(){i(n,!1)};return i(n,!0),n.scheduleOnce(r,t),function(){r(),n.unschedule(r)}}}},n.disableTouch=function(e,t){t?e.pauseSystemEvents(!0):e.resumeSystemEvents(!0)},n.randomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e},n.random=function(e,t){return Math.random()*(t-e)+e},n.compareVersion=function(e,t){for(var n=e.split("."),r=t.split("."),o=Math.max(n.length,r.length);n.length<o;)n.push("0");for(;r.length<o;)r.push("0");for(var i=0;i<o;i++){var a=parseInt(n[i]),c=parseInt(r[i]);if(a>c)return 1;if(a<c)return-1}return 0},n.sleep=function(e,t){return new Promise(function(n){t?t.scheduleOnce(function(){n()},e):cc.director.getScene().getComponentInChildren(cc.Canvas).scheduleOnce(function(){n()},e)})},n.shuffleArr=a,n.randomChoiceOne=function(e){return c(e,1)[0]},n.randomChoice=c,n.isObject=s,n.mergeDeep=function e(t){for(var n,o,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];if(!i.length)return t;var c=i.shift();if(s(t)&&s(c))for(var u in c)s(c[u])?(t[u]||Object.assign(t,((n={})[u]={},n)),e(t[u],c[u])):Object.assign(t,((o={})[u]=c[u],o));return e.apply(void 0,r([t],i))},n.deepClone=function e(t){var n;if("object"==typeof t)if(Array.isArray(t))for(var r in n=[],t)n.push(e(t[r]));else if(null===t)n=null;else if(t.constructor===RegExp)n=t;else for(var r in n={},t)n[r]=e(t[r]);else n=t;return n},n.clamp=u,n.mapRange=function(e,t,n,r,o){return u((e-t)*(o-r)/(n-t)+r,r,o)},n.isPord=!1,n.getLocalTouchPos=function(e,t){var n=e.getLocation();return cc.Camera.main.getScreenToWorldPoint(n,n),t.convertToNodeSpaceAR(n,n),n},cc._RF.pop()},{}],env:[function(e,t,n){"use strict";var r;cc._RF.push(t,"0ff909GluFHlajfQQM3N0t0","env"),Object.defineProperty(n,"__esModule",{value:!0}),n.env=n.EnvMode=void 0,function(e){e.Debug="Debug",e.TEST="Test",e.PROD="Prod"}(r=n.EnvMode||(n.EnvMode={})),n.env={version:"0.1.1",mode:r.TEST,network:{server:"https://xbtnc-test.hortor003.com",retryT:2,defaultRetryCnt:3,resourceURL:""}},cc._RF.pop()},{}],events:[function(e,t,n){"use strict";cc._RF.push(t,"a793cljNWpNmr4dFxYsHJjr","events"),Object.defineProperty(n,"__esModule",{value:!0}),n.resetAllEvents=n.gameEvent=n.GameEvent=n.logEvent=n.LogLevel=n.ON_NODE_REMOVE=n.BEFORE_NODE_REMOVE=void 0;var r=e("./typed-event");n.BEFORE_NODE_REMOVE="BEFORE_NODE_REMOVE",n.ON_NODE_REMOVE="ON_NODE_REMOVE",n.LogLevel={DEBUG:0,INFO:1,WARN:2,ERROR:3},n.logEvent=new r.TypedEvent,n.GameEvent={UserRoundFinished:"UserRoundFinished"},n.gameEvent=new r.TypedEvent;var o=[n.logEvent];n.logEvent.on(function(e){e.level||n.LogLevel.DEBUG;var t=e.log||"";console.log(t)}),n.resetAllEvents=function(){o.forEach(function(e){e.reset()})},cc._RF.pop()},{"./typed-event":"typed-event"}],"game-layer":[function(e,t,n){"use strict";cc._RF.push(t,"3e88dNKx4VLHJby+XBYQ76X","game-layer");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./manager/ui-manager"),u=e("./components/base/base-layer"),l=e("./components/ext/linked-prefab"),p=e("./components/card-deck"),f=e("./common/event/events"),d=e("./common/locker"),h=cc._decorator,y=h.ccclass,v=h.menu,g=h.property,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.playerDeckPrefab=null,t.oppositeDeckPrefab=null,t}return o(t,e),Object.defineProperty(t.prototype,"playerDeck",{get:function(){return this.playerDeckPrefab.getComponent(p.CardDeckComponent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oppositeDeck",{get:function(){return this.oppositeDeckPrefab.getComponent(p.CardDeckComponent)},enumerable:!1,configurable:!0}),t.prototype.testPanel=function(){return a(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,s.UI.openPanel("prefab/common/confirm-panel",null)];case 1:return e.sent(),[2]}})})},t.prototype.start=function(){var e=this;this.playerDeck.setMode(p.CardDeckMode.Player),this.oppositeDeck.setMode(p.CardDeckMode.Computer),f.gameEvent.on(function(t){return e.onGameEvent(t.name,t.data)}),this.startGame()},t.prototype.onGameEvent=function(){},t.prototype.selectCards=function(){return a(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return[4,s.UI.openPanel("prefab/select-card-panel",null)];case 1:return[2,e.sent().values]}})})},t.prototype.startGame=function(){return a(this,void 0,void 0,function(){var e,t,n,r,o,i,a;return c(this,function(c){switch(c.label){case 0:return e=this.playerDeck,t=this.oppositeDeck,[4,this.selectCards()];case 1:return n=c.sent(),[4,Promise.all([e.prepare(n),t.prepare(n.reverse())])];case 2:c.sent(),r=!1,o=0,c.label=3;case 3:return e.isDead()||t.isDead()?[3,8]:(e.setRound(o),t.setRound(o),[4,e.play(t.getAttributes())]);case 4:return i=c.sent(),[4,t.execute(i,t.getAttributes())];case 5:return c.sent(),t.isDead()?(r=!0,[3,8]):[4,t.play(e.getAttributes())];case 6:return a=c.sent(),[4,e.execute(a,e.getAttributes())];case 7:return c.sent(),e.isDead()?[3,8]:(o++,console.log("-----------"+o+"------------"),[3,3]);case 8:return r?console.log("player win"):console.log("player lose"),[2]}})})},i([g(l.default)],t.prototype,"playerDeckPrefab",void 0),i([g(l.default)],t.prototype,"oppositeDeckPrefab",void 0),i([d.touchLocker],t.prototype,"startGame",null),i([y,v("components/layers/GameLayer")],t)}(u.default);n.default=b,cc._RF.pop()},{"./common/event/events":"events","./common/locker":"locker","./components/base/base-layer":"base-layer","./components/card-deck":"card-deck","./components/ext/linked-prefab":"linked-prefab","./manager/ui-manager":"ui-manager"}],http:[function(e,t,n){"use strict";cc._RF.push(t,"0eb6eWvPY5Eea4TnDOpnL2l","http");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.post=n.get=void 0;var i=e("../common"),a=e("../env"),c=e("../toast"),s={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3},u=0,l=function(){return u++};function p(e){return null==e?"":Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t]+"")}).join("&")}function f(e,t){var n=p(t);return n.length>0?e+(-1===e.indexOf("?")?"?":"&")+n:e}function d(e){var t,n={ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText,data:e.responseText};if(n.ok)try{var r=JSON.parse(e.responseText);null!=r.errcode&&r.errcode>0&&(n.ok=!1,n.status=r.errcode,n.statusText=null!==(t=r.errmsg)&&void 0!==t?t:n.statusText),n.data=r.data}catch(o){console.error("failed to parse response text",e.responseText,o)}return n}function h(e,t,n){var r=s.ignoreCache,o=s.headers,i=s.timeout;return new Promise(function(c,s){var u=new XMLHttpRequest,l=f(t,{platform:"default",ver:a.env.version});n&&(l=f(l,n.parameters)),u.open(e,l),o&&Object.keys(o).forEach(function(e){u.setRequestHeader(e,o[e])}),r&&u.setRequestHeader("Cache-Control","no-cache"),u.timeout=i,u.onload=function(){c(d(u))},u.onerror=function(){c(d(u))},u.ontimeout=function(){s(new Error("Time out"))},"post"===e&&n.body?(u.setRequestHeader("Content-Type","application/json"),u.send(JSON.stringify(n.body))):u.send()})}function y(){return r(this,void 0,Promise,function(){return o(this,function(){return[2,!1]})})}function v(e,t,n){var c,s;return r(this,void 0,Promise,function(){var r,u,p,f,d,v,g,b,m;return o(this,function(o){switch(o.label){case 0:(n=null!=n?n:{}).parameters=null!==(c=n.parameters)&&void 0!==c?c:{},n.parameters.consistKey=l(),u=function(){n.silence||(r=setTimeout(function(){},200))},p=function(){null!=r&&clearTimeout(r)},f=null==n.askToRetry||1==n.askToRetry,d=Math.max(1,null!==(s=n.maxAutoRetryCnt)&&void 0!==s?s:a.env.network.defaultRetryCnt),v=0,o.label=1;case 1:if(!(v<d||f))return[3,11];o.label=2;case 2:return o.trys.push([2,4,,10]),u(),[4,h(e,t,n)];case 3:if(g=o.sent(),p(),g.status>=200&&g.status<=399||g.status>=2e4)return[2,g];throw g;case 4:if(b=o.sent(),p(),!n.silence)return[3,6];if(v==d-1)throw b;return[4,i.sleep(.5)];case 5:return o.sent(),[3,9];case 6:return(m=!f)?[3,8]:[4,y()];case 7:m=!o.sent(),o.label=8;case 8:if(m)throw b;o.label=9;case 9:return[3,10];case 10:return v++,[3,1];case 11:return[2]}})})}var g=function(){function e(e){this.method=e,this.queue=[]}return e.prototype.isEmpty=function(){return 0==this.queue.length},e.prototype.push=function(e){e.request=e.request||{};var t=this.isEmpty();this.queue.push(e),t&&this.consume()},e.prototype.clear=function(){for(;!this.isEmpty();)this.queue.pop().onFailed(new Error("the queue of "+this.method+" was cleared"))},e.prototype.handleError=function(e,t){console.log("handle error",t),t instanceof Error?e.onFailed(t):e.onFailed(new Error(t.statusText)),e.request.silence||(t instanceof Error?c.showToast(t.message):t.statusText?c.showToast(t.statusText):c.showToast("\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25"))},e.prototype.consume=function(){return r(this,void 0,void 0,function(){var e,t,n;return o(this,function(r){switch(r.label){case 0:e=this.queue[0],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,v(this.method,a.env.network.server+e.url,e.request)];case 2:return(t=r.sent()).ok?e.onSuccess(t):this.handleError(e,t),[3,4];case 3:return n=r.sent(),this.handleError(e,n),[3,4];case 4:return this.queue.shift(),this.isEmpty()||this.consume(),[2]}})})},e}(),b=new g("get"),m=new g("post");n.get=function(e,t){return r(this,void 0,Promise,function(){return o(this,function(){return[2,new Promise(function(n,r){b.push({request:t,url:e,onSuccess:function(e){n(e)},onFailed:function(e){r(e)}})})]})})},n.post=function(e,t){return r(this,void 0,Promise,function(){return o(this,function(){return[2,new Promise(function(n,r){m.push({url:e,request:t,onSuccess:function(e){n(e)},onFailed:function(e){r(e)}})})]})})},cc._RF.pop()},{"../common":"common","../env":"env","../toast":"toast"}],index:[function(e,t,n){"use strict";cc._RF.push(t,"a5207Jww3lAFYfn0QwbFaVc","index");var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.Event=n.ResUtil=n.HTTP=n.showToast=void 0;var i=e("./event/events");n.Event=i;var a=e("./network/http");n.HTTP=a;var c=e("./resources");n.ResUtil=c,o(e("./common"),n);var s=e("./toast");Object.defineProperty(n,"showToast",{enumerable:!0,get:function(){return s.showToast}}),cc._RF.pop()},{"./common":"common","./event/events":"events","./network/http":"http","./resources":void 0,"./toast":"toast"}],"layer-manager":[function(e,t,n){"use strict";cc._RF.push(t,"a30fckNP/NPvJ7CbGTe2Vww","layer-manager");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.layerEvent=n.LayerManager=void 0;var s=e("../common"),u=e("../common/event/typed-event"),l=e("../common/locker"),p=e("../components/base/base-layer"),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,v=f.disallowMultiple,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=null,t.currentLayer=null,t.swiftAnimaCount=0,t.isSwitching=!1,t}var r;return o(t,e),r=t,Object.defineProperty(t,"ins",{get:function(){var e=cc.director.getScene().getChildByName("Canvas");return e.getComponent(r)||e.getComponentInChildren(r)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.layers=[]},t.prototype.beforeSwitch=function(){return a(this,void 0,void 0,function(){return c(this,function(){return this.isSwitching?[2]:(this.isSwitching=!0,[2])})})},t.prototype.afterSwitch=function(){return a(this,void 0,void 0,function(){return c(this,function(){return this.isSwitching=!1,[2]})})},t.prototype.open=function(e,t){return a(this,void 0,Promise,function(){var r,o,i,u,l,f,d=this;return c(this,function(h){switch(h.label){case 0:return r=!1,this.swiftAnimaCount>0?(r=!0,[4,this.beforeSwitch()]):[3,2];case 1:h.sent(),h.label=2;case 2:return this.swiftAnimaCount++,[4,new Promise(function(t,n){cc.resources.load(e,cc.Prefab,function(e,r){e?n(e):t(r)})})];case 3:return o=h.sent(),cc.isValid(o)?(i=cc.instantiate(o),(u=i.getComponent(p.default))?(u.init(t),null!=(l=this.currentLayer)&&(l.getComponent(p.default).hide(),l.active=!1),(f=i.getComponent(cc.Widget))||(f=i.addComponent(cc.Widget)),f.isAlignHorizontalCenter=f.isAlignVerticalCenter=!1,f.isAlignRight=f.isAlignLeft=f.isAlignTop=f.isAlignBottom=!0,f.left=f.right=f.top=f.bottom=0,i.setParent(this.container),i.setSiblingIndex(this.container.childrenCount),[4,u.preLoad()]):(console.error("not found BaseLayer",e),[2,!1])):(console.warn("invalid prefab",e),[2,!1]);case 4:return h.sent(),r?[4,this.afterSwitch()]:[3,6];case 5:h.sent(),h.label=6;case 6:return u.show(),this.currentLayer=i,this.layers.push(i),n.layerEvent.emit({comp:u}),i.once(s.Event.BEFORE_NODE_REMOVE,function(e){return a(d,void 0,void 0,function(){var t,r,o,i,a;return c(this,function(c){switch(c.label){case 0:return[4,this.beforeSwitch()];case 1:return c.sent(),t=this.layers,-1==(r=t.findIndex(function(t){return t==e}))?[2]:(t.splice(r,1),0==(o=t.length)?(this.onNoLayerExists(),[2]):(i=t[o-1],a=i.getComponent(p.default),i.active||(i.active=!0,a.show()),n.layerEvent.emit({comp:a}),this.currentLayer=i,[4,this.afterSwitch()]));case 2:return c.sent(),[2]}})})}),[2]}})})},t.prototype.onNoLayerExists=function(){},i([h(cc.Node)],t.prototype,"container",void 0),i([l.touchLocker],t.prototype,"beforeSwitch",null),i([l.touchLocker],t.prototype,"afterSwitch",null),r=i([d,y("manager/layer-manager"),v],t)}(cc.Component);n.LayerManager=g,n.layerEvent=new u.TypedEvent,cc._RF.pop()},{"../common":"index","../common/event/typed-event":"typed-event","../common/locker":"locker","../components/base/base-layer":"base-layer"}],"linked-prefab":[function(e,t,n){"use strict";cc._RF.push(t,"5c4ba3tEg5PXpleEwDuudko","linked-prefab");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,s=a.executeInEditMode,u=a.property,l=a.menu,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prefab=null,t._prefabNode=null,t}return o(t,e),Object.defineProperty(t.prototype,"prefab",{get:function(){return this._prefab},set:function(e){this._onPrefabChanged(this._prefab,e)},enumerable:!1,configurable:!0}),t.prototype._onPrefabChanged=function(e,t){if(e!=t&&(this._prefab=t,t)){var n=cc.instantiate(t);this._prefabNode=n,n&&(n._objFlags|=cc.Object.Flags.DontSave|cc.Object.Flags.LockedInEditor|cc.Object.Flags.HideInHierarchy,this.node.addChild(n,-1),this.node.width=n.width,this.node.height=n.height)}},t.prototype.onLoad=function(){this._onPrefabChanged(null,this._prefab)},t.prototype.getComponent=function(e){return this._prefabNode.getComponent(e)},i([u],t.prototype,"_prefab",void 0),i([u({type:cc.Prefab,visible:!0})],t.prototype,"prefab",null),i([c,s,l("ext/linked-prefab")],t)}(cc.Component);n.default=p,cc._RF.pop()},{}],locker:[function(e,t,n){"use strict";cc._RF.push(t,"37834vilIBCmow+NMCOxuNL","locker");var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};Object.defineProperty(n,"__esModule",{value:!0}),n.onSceneChanged=n.touchLocker=n.disableTouch=n.isTouchLocked=n.unstashLocker=n.stashLocker=void 0;var o=e("./common");function i(e,t,n){return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];t&&t.call.apply(t,r([e],o)),n&&n()}}var a=new Set,c=[];a.add=i(a,a.add,function(){s()}),a.delete=i(a,a.delete,function(){s()});var s=function(){var e=n.isTouchLocked();o.disableAllTouch(e)},u=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^o.randomInt(0,1e12)&15>>e/4).toString(16)})};function l(e){a.delete(e),c.forEach(function(t){t.delete(e)})}n.stashLocker=function(){c.push(new Set(a)),a.clear(),s()},n.unstashLocker=function(){a.clear(),c.length>0&&c.pop().forEach(function(e){a.add(e)}),s()},n.isTouchLocked=function(){return a.size>0},n.disableTouch=function(){var e=u();return a.add(e),function(){a.delete(e)}},n.touchLocker=function(e,t,n){var o=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=u();a.add(n);var c=o.call.apply(o,r([this],e));return c instanceof Promise?c.then(function(){l(n)}):l(n),this instanceof cc.Component&&(this.onDestroy=i(this,this.onDestroy,function(){l(n)})),c}},n.onSceneChanged=function(){o.resetGlobalBlockInputComp()},cc._RF.pop()},{"./common":"common"}],"object-pool":[function(e,t,n){"use strict";cc._RF.push(t,"591a5VZwTNFBI66zfx+X1jj","object-pool");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.objectPool=void 0;var i=e("../components/card"),a=e("../manager/resources"),c=function(){function e(e){this._pool=[],this._factory=e}return e.prototype.get=function(){return r(this,void 0,void 0,function(){var e,t;return o(this,function(n){switch(n.label){case 0:return this._pool.length>0?(e=this._pool.pop(),[3,4]):[3,1];case 1:return(t=this._factory())instanceof Promise?[4,t]:[3,3];case 2:return e=n.sent(),[3,4];case 3:e=t,n.label=4;case 4:return e instanceof cc.Node&&e.getComponent(i.CardComponent)&&e.getComponent(i.CardComponent).recycle(),[2,e]}})})},e.prototype.put=function(e){e instanceof cc.Node&&(e.removeFromParent(),cc.Tween.stopAllByTarget(e),e.cleanup()),this._pool.push(e)},e}();n.objectPool={cardPool:new c(function(){return r(void 0,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return[4,a.loadPrefab("prefab/components/Card")];case 1:return e=t.sent(),[2,cc.instantiate(e)]}})})})},cc._RF.pop()},{"../components/card":"card","../manager/resources":"resources"}],"panel-manager":[function(e,t,n){"use strict";cc._RF.push(t,"90028WwXTlFYYSQWtS3lhV5","panel-manager");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.PanelManager=n.PanelShowResult=void 0;var s,u=e("../common/locker"),l=e("../components/base/base-panel"),p=e("./layer-manager"),f=cc._decorator,d=f.ccclass,h=f.property,y=f.menu,v=f.disallowMultiple;(function(e){e[e.DONE=0]="DONE",e[e.FAILED=1]="FAILED",e[e.WAITING=2]="WAITING"})(s=n.PanelShowResult||(n.PanelShowResult={}));var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=null,t.mask=null,t}var n;return o(t,e),n=t,Object.defineProperty(t,"ins",{get:function(){var e=cc.director.getScene().getChildByName("Canvas");return e.getComponent(n)||e.getComponentInChildren(n)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.panelQueue=[],this.panelList=[],this.mask.active=!1},t.prototype.open=function(e,t,n){return a(this,void 0,Promise,function(){var r,o,i,a,f=this;return c(this,function(c){switch(c.label){case 0:return(n=null!=n?n:{}).inQueue&&this.panelQueue.length>0?(this.panelQueue.push({prefab:e,data:t,opt:n}),[2,{panelResult:s.WAITING}]):[4,new Promise(function(t,n){cc.resources.load(e,cc.Prefab,function(e,r){e?n(e):t(r)})})];case 1:return r=c.sent(),cc.isValid(r)?(o=cc.instantiate(r),(i=o.getComponent(l.default))?((a=o.getComponent(cc.Widget))||(a=o.addComponent(cc.Widget)),a.isAlignTop=a.isAlignBottom=a.isAlignLeft=a.isAlignRight=!0,a.top=a.bottom=a.left=a.right=0,a.alignMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,this.currentPanel=o,this.panelList.push({prefab:e,data:t,opt:n,node:o}),o.setParent(this.container),i.show(t),this.ensureMask(),p.layerEvent.emit({comp:i}),u.stashLocker(),[2,new Promise(function(e){i.setFinishCallback(function(t,n){f.currentPanel=null,t.parent=null,f.panelList.pop(),e({panelResult:s.DONE,values:n}),u.unstashLocker(),f.onNext(),f.scheduleOnce(function(){f.ensureMask(),p.layerEvent.emit({comp:null})},0)})})]):(console.warn("failed to load component of prefab",e),[2,{panelResult:s.FAILED}])):(console.warn("invalid prefab",e),[2,{panelResult:s.FAILED}])}})})},t.prototype.onNext=function(){if(null==this.currentPanel&&0!=this.panelQueue.length){var e=this.panelQueue.shift();this.open(e.prefab,e.data,e.opt)}},t.prototype.ensureMask=function(){var e=this.panelList,t=e.length,n=this.container.childrenCount,r=this.mask;if(t<=0)r.active=!1;else{var o=e[t-1].node;r.active=!0,o.active=!0,r.setSiblingIndex(n),o.setSiblingIndex(n)}},t.prototype.onMaskClick=function(){var e=this.panelList,t=e.length;if(!(t<=0)){var n=e[t-1],r=n.opt,o=n.node;r.clickMaskToClose&&o.getComponent(l.default).hide()}},i([h(cc.Node)],t.prototype,"container",void 0),i([h(cc.Node)],t.prototype,"mask",void 0),n=i([d,y("manager/panel-manager"),v],t)}(cc.Component);n.PanelManager=g,cc._RF.pop()},{"../common/locker":"locker","../components/base/base-panel":"base-panel","./layer-manager":"layer-manager"}],prefab:[function(e,t,n){"use strict";cc._RF.push(t,"45ab66RnohAYLtugJhqcuLB","prefab"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],resources:[function(e,t,n){"use strict";cc._RF.push(t,"88e87O9b1JAjrnunRmE3z8w","resources");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.getResFromBundle=n.loadRes=n.loadRemote=n.loadLocalRes=n.loadAnimaClip=n.preloadPrefab=n.loadPrefab=void 0;var i=e("../common/env");function a(e,t){return r(this,void 0,Promise,function(){var n,r;return o(this,function(o){switch(o.label){case 0:return e?(n=cc.resources,[4,c("resources",e,t)]):[2];case 1:return(r=o.sent())?[2,r]:[2,new Promise(function(r,o){n.load(e,t,function(e,t){e?o(e):r(t)})})]}})})}function c(e,t,n){return r(this,void 0,Promise,function(){var r,i;return o(this,function(){return t&&(r=s(e,t,n))&&(i=cc.assetManager.assets.get(r))?[2,i]:[2,null]})})}function s(e,t,n){var r=cc.assetManager.bundles,o=function(e){if(!r.has(e))return null;var i=r.get(e).getInfoWithPath(t,n);return i?i.redirect?o(i.redirect):i.uuid:null};return o(e)}n.loadPrefab=function(e){return r(this,void 0,Promise,function(){return o(this,function(t){switch(t.label){case 0:return[4,a(e,cc.Prefab)];case 1:return[2,t.sent()]}})})},n.preloadPrefab=function(e){return r(this,void 0,Promise,function(){return o(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){cc.resources.preload(e,cc.Prefab,function(){t()})})];case 1:return t.sent(),[2]}})})},n.loadAnimaClip=function(e){return r(this,void 0,Promise,function(){return o(this,function(t){switch(t.label){case 0:return[4,a(e,cc.AnimationClip)];case 1:return[2,t.sent()]}})})},n.loadLocalRes=function(e){return a(e,cc.Asset)},n.loadRemote=function(e){return r(this,void 0,Promise,function(){return o(this,function(){return e?[2,new Promise(function(t,n){cc.assetManager.loadRemote(i.env.network.resourceURL+e,function(e,r){e?n(e):t(r)})})]:[2]})})},n.loadRes=a,n.getResFromBundle=c,cc._RF.pop()},{"../common/env":"env"}],router:[function(e,t,n){"use strict";cc._RF.push(t,"64ea7SsIWpGALStna0baNNE","router"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}],"select-card-panel":[function(e,t,n){"use strict";cc._RF.push(t,"63b9foYcoZHS6y4t+e6EmRs","select-card-panel");var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./components/base/base-panel"),u=e("./components/card-placeholder"),l=e("./components/ext/linked-prefab"),p=e("./common/object-pool"),f=e("./components/card"),d=e("./common/locker"),h=e("./game-logic/card-manager"),y=cc._decorator,v=y.ccclass,g=y.property,b=y.menu,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cardPlaceholdersRaw=[],t.cardPool=null,t.holdingCard=null,t.cards=[],t.selectedCard=null,t.selectHolder=null,t.holderCardMap=new Map,t.cardHolderMap=new Map,t}return o(t,e),Object.defineProperty(t.prototype,"cardPlaceholders",{get:function(){return this.cardPlaceholdersRaw.map(function(e){return e.getComponent(u.CardPlaceholderComponent)})},enumerable:!1,configurable:!0}),t.prototype.playEnterAnima=function(){return a(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return this.initHolders(6),[4,this.createCards(6)];case 1:return e.sent(),[4,this.playCardsAnimation(!0)];case 2:return e.sent(),this.addListeners(),[2]}})})},t.prototype.initHolders=function(e){for(var t=this.cardPlaceholders,n=0,r=t.length;n<r;n++){var o=t[n];o.holderIdx=n,o.setIsLocked(n>=e)}},t.prototype.createCards=function(e){return a(this,void 0,void 0,function(){var t,n,r,o;return c(this,function(i){switch(i.label){case 0:t=[h.cardConfigManager.getCard(1),h.cardConfigManager.getCard(2),h.cardConfigManager.getCard(3),h.cardConfigManager.getCard(4),h.cardConfigManager.getCard(5),h.cardConfigManager.getCard(6)],n=0,i.label=1;case 1:return n<e?[4,p.objectPool.cardPool.get()]:[3,4];case 2:r=i.sent(),(o=r.getComponent(f.CardComponent)).setIsVisible(!0),o.setCardConf(t[n%t.length]),this.cardPool.addChild(r),this.cards.push(o),r.opacity=0,i.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.getCardX=function(e){return 50+50*e},t.prototype.playCardsAnimation=function(e){return void 0===e&&(e=!1),a(this,void 0,void 0,function(){var t,n,r,o,i;return c(this,function(a){switch(a.label){case 0:for(t=[],n=function(n,o){var i=r.cards[n],a=r.getCardX(n);e&&(i.node.x=a+150),i.node.setSiblingIndex(o-n-1),t.push(new Promise(function(e){cc.tween(i.node).delay(5*n/24).to(.7,{x:a,opacity:255},{easing:cc.easing.sineIn}).call(function(){e()}).start()}))},r=this,o=0,i=this.cards.length;o<i;o++)n(o,i);return[4,Promise.all(t)];case 1:return a.sent(),[2]}})})},t.prototype.addListeners=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},t.prototype.onHide=function(){this.removeListeners()},t.prototype.removeListeners=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},t.prototype.onTouchBegin=function(e){var t=this.cards;this.selectedCard=null;for(var n=0,r=t.length;n<r;n++){var o=t[n];if(o.hitTest(e)){this.selectedCard=o;break}}if(this.selectedCard){var i=this.selectedCard;i.beforeMoving(),i.setSelect(!0)}},t.prototype.onTouchMove=function(e){this.selectedCard&&(this.selectedCard.setMoving(e),this.selectHolder=this.getTouchedHolder(e))},t.prototype.getTouchedHolder=function(e){for(var t=this.cardPlaceholders,n=null,r=0,o=t.length;r<o;r++)if(!t[r].isLocked&&t[r].hitTest(e)){n=t[r];break}return n},t.prototype.onTouchEnd=function(){return a(this,void 0,void 0,function(){var e,t,n,r;return c(this,function(){return this.selectedCard?(e=this.selectHolder,(t=this.selectedCard).setSelect(!1),e?(n=this.holderCardMap.get(e),r=this.cardHolderMap.get(t),this.holderCardMap.delete(r),this.cardHolderMap.delete(n),n&&r?(this.putCardToHolder(n,r),this.putCardToHolder(t,e)):n?(console.log("put card back to pool"),this.putCardBackToPool(n,t),this.putCardToHolder(t,e)):this.putCardToHolder(t,e)):t.afterMoving(!0),[2]):[2]})})},t.prototype.putCardBackToPool=function(e,t){e.node.parent=this.cardPool;var n=t.getDataBeforeMoving(),r=n.pos,o=n.zIndex;e.node.setPosition(r),e.node.zIndex=o},t.prototype.putCardToHolder=function(e,t){var n=t.node.getPosition();t.node.convertToWorldSpaceAR(n,n),this.holdingCard.convertToNodeSpaceAR(n,n),e.node.parent=this.holdingCard,e.node.setPosition(n),this.holderCardMap.set(t,e),this.cardHolderMap.set(e,t)},t.prototype.submit=function(){for(var e=this.cardPlaceholders,t=this.holderCardMap,n=[],r=0,o=e.length;r<o;r++){var i=e[r];if(i.isLocked)break;var a=t.get(i);a&&n.push(a.conf)}this.setReturnValue(n),this.hide()},i([g([l.default])],t.prototype,"cardPlaceholdersRaw",void 0),i([g(cc.Node)],t.prototype,"cardPool",void 0),i([g(cc.Node)],t.prototype,"holdingCard",void 0),i([d.touchLocker],t.prototype,"onTouchEnd",null),i([v,b("panel/SelectCard")],t)}(s.default);n.default=m,cc._RF.pop()},{"./common/locker":"locker","./common/object-pool":"object-pool","./components/base/base-panel":"base-panel","./components/card":"card","./components/card-placeholder":"card-placeholder","./components/ext/linked-prefab":"linked-prefab","./game-logic/card-manager":"card-manager"}],sound:[function(e,t,n){"use strict";cc._RF.push(t,"1738bb0rj9PW4sQR3SWMTRI","sound");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.sound=n.Sound=void 0;var i,a=e("../user/userdata");(function(e){e.COMMON="sound/common",e.BGM="sound/bgm"})(i=n.Sound||(n.Sound={}));var c=function(){function e(){this.isSharing=!1,this.isHiding=!1,this.delayKey=0,this.clips={}}return e.prototype.onSoundChange=function(){var e=this;clearTimeout(this.delayKey),this.delayKey=setTimeout(function(){clearTimeout(e.delayKey),e.delayKey=0,e.isSharing||e.isHiding?e.stopAll():e.resumeAll()},100)},e.prototype.resumeAll=function(){cc.audioEngine.resumeMusic(),cc.audioEngine.resumeAllEffects(),this.onBGMSwitchChange()},e.prototype.stopAll=function(){cc.audioEngine.stopMusic(),cc.audioEngine.stopAllEffects()},e.prototype.play=function(e,t){return void 0===t&&(t=1),r(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:return!1===a.userData.setting.getValue("bgm")?[2]:(t=Math.min(1,Math.max(0,t)),e instanceof cc.AudioClip?(n=e,[3,4]):[3,1]);case 1:return null==this.clips[e]?[3,2]:(n=this.clips[e],[3,4]);case 2:return[4,new Promise(function(t){cc.resources.load(e,cc.AudioClip,function(e,n){t(e?null:n)})})];case 3:n=r.sent(),this.clips[e]=n,r.label=4;case 4:return n?(cc.audioEngine.playEffect(n,!1),cc.audioEngine.setEffectsVolume(t),[2]):[2]}})})},e.prototype.playBGM=function(){return r(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return a.userData.setting.getValue("bgm")?(this.bgmID=0,[4,new Promise(function(e){cc.resources.load(i.BGM,cc.AudioClip,function(t,n){e(t?null:n)})})]):[2];case 1:return e=t.sent(),this.bgmID=cc.audioEngine.playMusic(e,!0),cc.audioEngine.setMusicVolume(.5),[2]}})})},e.prototype.onBGMSwitchChange=function(){var e=cc.audioEngine.getState(this.bgmID)!=cc.audioEngine.AudioState.ERROR;a.userData.setting.getValue("bgm")?e?cc.audioEngine.resumeMusic():this.playBGM():e&&cc.audioEngine.stopMusic()},e}();n.sound=new c,window.sound=n.sound,cc._RF.pop()},{"../user/userdata":"userdata"}],time:[function(e,t,n){"use strict";cc._RF.push(t,"2e98btN7bdEioEXk8VfzlyP","time"),Object.defineProperty(n,"__esModule",{value:!0}),n.formatTimeString=n.time=n.timeEvent=n.getFullDisplayDateTime=n.getFullDisplayTime=n.getFullDisplayDate=n.addZero=n.isToday=n.isSameDay=void 0;var r=e("./event/typed-event"),o=function(){function e(){this.weekDay=-1,this._cachedZoneOffset=null,this.dayChangeT=-1,this.initd=!1}return e.prototype.sync=function(e){var t,n;null!=e&&null!=e.serverTime?(this.serverStartT=1e3*e.serverTime,this.clientStartT=Date.now(),this.weekDay=null!==(t=e.weekDay)&&void 0!==t?t:-1,this.dayChangeT=null!==(n=e.dayChangeT)&&void 0!==n?n:-1):console.warn("invalid server time")},Object.defineProperty(e.prototype,"serverTime",{get:function(){var e=Math.floor((this.serverStartT+Date.now()-this.clientStartT)/1e3);if(isNaN(e))return Math.floor(Date.now()/1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeZoneOffset",{get:function(){if(null==this._cachedZoneOffset){var e=new Date,t=Math.round(e.getTimezoneOffset()/6);this._cachedZoneOffset=-t/10}return this._cachedZoneOffset},enumerable:!1,configurable:!0}),e.prototype.startGlobalTimer=function(e){var t=this;e.schedule(function(e){var r=n.time.serverTime,o=r>t.dayChangeT&&t.dayChangeT>0;o&&(t.dayChangeT+=93600),n.timeEvent.emit({now:r,dt:e,dayChange:o})},1,cc.macro.REPEAT_FOREVER)},e}();function i(e,t){var n=new Date(1e3*e),r=new Date(1e3*t);return n.getFullYear()==r.getFullYear()&&n.getMonth()==r.getMonth()&&n.getDate()==r.getDate()}function a(e){return e<10?"0"+e:e+""}function c(e){var t=new Date(1e3*e);return t.getFullYear()+"/"+a(t.getMonth()+1)+"/"+a(t.getDate())}function s(e){var t=new Date(1e3*e);return a(t.getHours())+":"+a(t.getMinutes())+":"+a(t.getSeconds())}n.isSameDay=i,n.isToday=function(e){return i(n.time.serverTime,e)},n.addZero=a,n.getFullDisplayDate=c,n.getFullDisplayTime=s,n.getFullDisplayDateTime=function(e){return c(e)+" "+s(e)},n.timeEvent=new r.TypedEvent,n.time=new o,window.time=n.time,n.formatTimeString=function(e,t){if(e<=0)return t?"00:00:00":"00:00";var n=e%60,r=(e=(e-n)/60)%60,o=(e-r)/60,i="";return(o>0||t)&&(o<10&&(o="0"+o),i+=o+":"),r<10&&(r="0"+r),n<10&&(n="0"+n),(i+=r+":")+n},cc._RF.pop()},{"./event/typed-event":"typed-event"}],toast:[function(e,t,n){"use strict";cc._RF.push(t,"e014bmTxNhIlpPak2KPWnDC","toast");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.showToast=void 0;var i=e("../manager/resources");n.showToast=function(e,t){return void 0===t&&(t=3e3),r(this,void 0,void 0,function(){var n,r,a,c,s,u,l,p,f,d,h;return o(this,function(o){switch(o.label){case 0:return null==e||""==e?[2]:(n=cc.director.getScene().getComponentInChildren(cc.Canvas),(r=n.node.getChildByName("Toast"))&&r.destroy(),[4,i.loadLocalRes("ui/guide/common_txt_bg")]);case 1:return a=o.sent(),(c=new cc.Node("Toast")).opacity=0,s=new cc.Node("LabelNode"),(u=s.addComponent(cc.Label)).enableBold=!0,u.fontSize=50,u.lineHeight=50,s.addComponent(cc.LabelOutline).color=cc.Color.BLACK,s.getComponent(cc.LabelOutline).width=4,u.string=e,(l=c.addComponent(cc.Layout)).resizeMode=cc.Layout.ResizeMode.NONE,l.paddingLeft=30,l.paddingRight=30,l.paddingTop=25,l.paddingBottom=20,(p=c.addComponent(cc.Sprite)).type=cc.Sprite.Type.SLICED,p.spriteFrame=a,c.addChild(s),n.node.addChild(c),f=cc.callFunc(function(){cc.tween(c).to(.3,{opacity:255}).start()}),d=cc.callFunc(function(){var e=setTimeout(function(){c.destroy(),clearTimeout(e)},t)},this),h=cc.sequence(f,d),c.runAction(h),[2]}})})},cc._RF.pop()},{"../manager/resources":"resources"}],"typed-event":[function(e,t,n){"use strict";cc._RF.push(t,"3455cEfP7NFLoL+iGdgHa17","typed-event"),Object.defineProperty(n,"__esModule",{value:!0}),n.TypedEvent=void 0;var r=function(){function e(){var e=this;this.listeners=[],this.listenersOnce=[],this.on=function(t){return e.listeners.push(t),{dispose:function(){return e.off(t)}}},this.once=function(t){e.listenersOnce.push(t)},this.off=function(t){var n=e.listeners.indexOf(t);n>-1&&e.listeners.splice(n,1)},this.emit=function(t){e.listeners.forEach(function(e){return e(t)}),e.listenersOnce.forEach(function(e){return e(t)}),e.listenersOnce=[]},this.pipe=function(t){return e.on(function(e){return t.emit(e)})}}return e.prototype.reset=function(){this.listeners=[]},e}();n.TypedEvent=r,cc._RF.pop()},{}],"ui-manager":[function(e,t,n){"use strict";cc._RF.push(t,"d42c6RD181OUoUo3aiLdgnY","ui-manager");var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}s((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(e){return function(t){return s([e,t])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.UI=void 0;var i=e("../components/base/base-layer"),a=e("../components/base/base-panel"),c=e("./layer-manager"),s=e("./panel-manager"),u=function(){function e(){}return e.openPanel=function(e,t,n){return r(this,void 0,Promise,function(){return o(this,function(){return[2,s.PanelManager.ins.open(e,t,n)]})})},e.openLayer=function(e,t){return r(this,void 0,Promise,function(){return o(this,function(){return[2,c.LayerManager.ins.open(e,t)]})})},e.getTopView=function(){var e=s.PanelManager.ins.panelList;if(e.length>0){var t=e[e.length-1];if(t.node)return t.node.getComponent(a.default)}var n=c.LayerManager.ins.layers;if(n.length>0)return n[n.length-1].getComponent(i.default)},e.getTopLayer=function(){var e=c.LayerManager.ins.layers;if(e.length>0)return e[e.length-1].getComponent(i.default)},e.getTopPanel=function(){var e=s.PanelManager.ins.panelList;if(e.length>0)return e[e.length-1].node},e.getPanelByName=function(e){for(var t=s.PanelManager.ins.panelList,n=0;n<t.length;++n)if(t[n].node.name==e)return t[n].node;return null},e}();n.UI=u,cc._RF.pop()},{"../components/base/base-layer":"base-layer","../components/base/base-panel":"base-panel","./layer-manager":"layer-manager","./panel-manager":"panel-manager"}],userdata:[function(e,t,n){"use strict";cc._RF.push(t,"f4398zebxtHw5d+AKiZt48o","userdata"),Object.defineProperty(n,"__esModule",{value:!0}),n.userData=void 0;var r=function(){function e(){this.settings={bgm:!0},this.proxy=new Proxy(this.settings,{set:function(e,t,n){return e[t]=n,console.log("Set "+String(t)+" to "+n),!0}}),this.load()}return e.prototype.save=function(){localStorage.setItem("user_settings",JSON.stringify(this.settings))},e.prototype.load=function(){var e=this,t=localStorage.getItem("user_settings");if(t){var n=JSON.parse(t);Object.keys(n).forEach(function(t){e.settings[t]=n[t]})}},e.prototype.getValue=function(e){return this.proxy[e]},e.prototype.setValue=function(e,t){this.proxy[e]=t,this.save()},e}(),o=function(){function e(){this.setting=new r,this.cards=[]}return e.prototype.load=function(){var e=localStorage.getItem("user_data");if(e){var t=JSON.parse(e);this.cards=t.cards}},e.prototype.save=function(){var e={cards:this.cards},t=JSON.stringify(e);localStorage.setItem("user_data",t)},e.prototype.loadDebug=function(){this.cards=[{id:1,level:1},{id:2,level:1},{id:1,level:2}]},e}();n.userData=new o,cc._RF.pop()},{}]},{},["Main","common","env","events","typed-event","index","locker","http","router","object-pool","sound","time","toast","bar","base-layer","base-panel","card-deck","card-placeholder","card","linked-prefab","prefab","game-layer","card-data-type","card-manager","command-parser","layer-manager","panel-manager","resources","ui-manager","select-card-panel","userdata"]);